# LeetCode Data Specification

## Overview

This document defines the **exact data fields** required from LeetCode for each question in the LeetCodePrepTop300 project. It covers the raw scrape format (`raw_questions/`), the processing pipeline, and the split `data/` output consumed by the frontend.

---

## Table of Contents

1. [Raw Question JSON Schema](#1-raw-question-json-schema-raw_questions)
2. [Processing Pipeline](#2-processing-pipeline-process_datapy)
3. [Frontend Data Format — `data/` folder](#3-frontend-data-format--data-folder)
   - [Individual question files — `data/<id>.json`](#31-individual-question-files--dataidjson)
   - [Index file — `data/index.json`](#32-index-file--dataindexjson)
4. [Java Conversion Pipeline](#4-java-conversion-pipeline-java_converterpy)
5. [Premium-Locked Questions](#5-premium-locked-questions)
6. [Scraping Notes](#6-scraping-notes)

---

## 1. Raw Question JSON Schema (`raw_questions/`)

Each question is stored as a single `.json` file under `raw_questions/` named `{questionFrontendId}-{titleSlug}.json`.

### Required Fields

| Field | Type | Source | Notes |
|---|---|---|---|
| `questionFrontendId` | `string` | LeetCode GraphQL API | The public-facing number (e.g. `"1"`, `"296"`). Used as the question's primary ID throughout the app. |
| `title` | `string` | LeetCode GraphQL API | Human-readable title (e.g. `"Two Sum"`). |
| `difficulty` | `string` | LeetCode GraphQL API | Must be one of: `"Easy"`, `"Medium"`, `"Hard"`. |
| `content` | `string \| null` | LeetCode GraphQL API | Full HTML of the problem description, including examples and constraints. **`null` for Premium-locked questions** — this is expected and handled gracefully. |
| `topicTags` | `array<object>` | LeetCode GraphQL API | Array of tag objects. Each object must include at minimum: `{ "name": string, "slug": string }`. Used to populate the tag filter sidebar. |
| `codeSnippets` | `array<object> \| null` | LeetCode GraphQL API | Array of starter code templates per language. Each object: `{ "lang": string, "langSlug": string, "code": string }`. The pipeline extracts the **Java** entry. `null` acceptable if no snippets available. |
| `solution` | `object \| null` | LeetCode GraphQL API (editorial) | Object containing `{ "content": string, "isOfficial": boolean }`. `content` is the full HTML editorial. `null` if no editorial exists. |

### Optional / Informational Fields (not used by frontend)

| Field | Type | Notes |
|---|---|---|
| `questionId` | `string` | Internal LeetCode database ID, not the public number. |
| `titleSlug` | `string` | URL-safe slug (e.g. `"two-sum"`). Useful for deep-linking to LeetCode.com. |
| `stats` | `string` (JSON) | Acceptance rate and submission counts. |
| `hints` | `array<string>` | Official hints for the problem. |
| `similarQuestions` | `string` (JSON) | List of related problems. |
| `companyTags` | `array<object> \| null` | Companies that have asked this question. Often `null` without premium. |

---

## 2. Processing Pipeline (`process_data.py`)

The pipeline reads every `raw_questions/*.json` file and produces the `data/` folder via `split_data.py`.

### Transformations Applied

1. **Tag extraction** — `topicTags[].name` is flattened to a plain `string[]`.
2. **Java snippet extraction** — find the entry in `codeSnippets` where `lang == "Java"` and extract `code`.
3. **Solution sanitization** — from `solution.content`:
   - Strip `<img>`, `<iframe>`, `<video>`, `<figure>` tags.
   - If the editorial contains **at least one Java code block** (detected by heuristics on `<pre>` text), remove all non-Java `<pre>` blocks to keep the solution language-consistent.
4. **Sorting** — questions are sorted ascending by `questionFrontendId` (numeric).

---

## 3. Frontend Data Format — `data/` folder

The `data/` folder is the sole data source consumed by the frontend. It is generated by running `split_data.py` after `process_data.py`.

```
data/
├── index.json      ← lightweight index for the list/search page (~33 KB)
├── 1.json          ← full question data for question #1 (~20 KB avg)
├── 2.json
├── ...
└── 300.json
```

> **How it is generated:**
> ```bash
> python3 process_data.py   # raw_questions/ → data.js  (intermediate)
> python3 split_data.py     # data.js → data/*.json
> ```

---

### 3.1 Individual question files — `data/<id>.json`

**Filename:** `data/{id}.json` where `id` is the `questionFrontendId` (e.g. `data/42.json`).

**Fetched by:** `question.js` via `fetch('data/<id>.json')` when the user opens a question.

#### Schema

```jsonc
{
  "id":           "42",          // string — questionFrontendId
  "title":        "Trapping Rain Water",
  "difficulty":   "Hard",        // "Easy" | "Medium" | "Hard"
  "content":      "<p>…</p>",    // string | null — full HTML problem description
                                 // null for premium-locked questions
  "tags":         ["Array", "Two Pointers", "Dynamic Programming"],
                                 // string[] — flat list of topic tag names
  "java_snippet": "class Solution {\n    public int trap(int[] height) {\n        \n    }\n}",
                                 // string — Java starter code; empty string if unavailable
  "solution":     "<h2>…</h2>"  // string — sanitized HTML editorial; empty string if unavailable
}
```

#### Field Rules

| Field | Type | Nullable / Default | Notes |
|---|---|---|---|
| `id` | `string` | required | Numeric string matching the filename (e.g. `"42"`). |
| `title` | `string` | required | Human-readable title. |
| `difficulty` | `string` | required | `"Easy"`, `"Medium"`, or `"Hard"`. |
| `content` | `string \| null` | nullable | HTML. `null` means premium-locked — the frontend shows a placeholder. |
| `tags` | `string[]` | `[]` if missing | Flat array of tag name strings. |
| `java_snippet` | `string` | `""` if missing | Raw Java code string (no HTML). |
| `solution` | `string` | `""` if missing | HTML editorial. May contain `<pre><code>`, `<table>`, `<ul>`, etc. |

---

### 3.2 Index file — `data/index.json`

**Fetched by:** `app.js` on page load for the question list/search page. Also fetched once by `question.js` for prev/next navigation.

**Size target:** ≤ 50 KB (currently ~33 KB for 300 questions).

#### Schema

```jsonc
[
  {
    "id":         "1",
    "title":      "Two Sum",
    "difficulty": "Easy",
    "tags":       ["Array", "Hash Table"]
  },
  {
    "id":         "2",
    "title":      "Add Two Numbers",
    "difficulty": "Medium",
    "tags":       ["Linked List", "Math", "Recursion"]
  },
  // ... one entry per question, sorted by id ascending
]
```

#### Field Rules

| Field | Type | Notes |
|---|---|---|
| `id` | `string` | Matches the filename `data/{id}.json`. |
| `title` | `string` | Used for text search on the list page. |
| `difficulty` | `string` | Used for difficulty filter dropdown. |
| `tags` | `string[]` | Used for the tag filter sidebar. |

> ⚠️ **`content`, `java_snippet`, and `solution` are intentionally omitted** from `index.json` to keep it small. Never add heavy fields here.

---

## 4. Java Conversion Pipeline (`java_converter.py`)

Used as a **post-processing step** for questions whose editorial only contains C++ code.

### Trigger Condition

A question goes into `needs_conversion.json` if:
- `solution.content` is non-empty, **and**
- No Java code block is detected in the editorial (heuristic: looks for `class Solution`, `public int`, `public void`, etc., absence of C++ markers like `std::`, `vector<`, `#include`).

### Process

1. The raw `solution.content` HTML is sent to Gemini (`gemini-2.5-flash`) with a prompt to rewrite all code blocks to Java while preserving the surrounding article structure.
2. If the returned HTML passes the Java detection heuristic, the raw JSON file is **overwritten** with the converted solution.
3. A 2-second delay is applied between conversions to respect API rate limits.

### Requirement

Needs `GEMINI_API_KEY` environment variable set.

---

## 5. Premium-Locked Questions

As of the initial scrape (Feb 2026), some questions have `content: null` because LeetCode requires a Premium subscription to access their problem statements.

These questions **still have**:
- Title, difficulty, tags ✅
- Java starter code snippet (sometimes `null` too) ⚠️
- Editorial solution (usually available) ✅

The frontend handles `null` content gracefully by showing a placeholder message.

---

## 6. Scraping Notes

When fetching data from LeetCode's GraphQL API, the following query fields should be requested:

```graphql
question(titleSlug: $titleSlug) {
  questionId
  questionFrontendId
  title
  titleSlug
  content
  difficulty
  stats
  hints
  similarQuestions
  topicTags {
    name
    slug
  }
  companyTags {
    name
    slug
  }
  codeSnippets {
    lang
    langSlug
    code
  }
  solution {
    content
    isOfficial
  }
}
```

> ⚠️ **`content` and `codeSnippets`** will be `null` for Premium-locked questions unless scraped with an authenticated Premium session cookie.
> ⚠️ **`solution`** (editorial) may also be `null` for questions without an official editorial.

---

## 7. Regenerating `data/` from Scratch

If you update any raw question files or re-run the processing pipeline:

```bash
# Step 1: Rebuild data.js from raw_questions/
python3 process_data.py

# Step 2: Split data.js into individual JSON files
python3 split_data.py

# Step 3: (Optional) Archive or delete data.js — it is no longer used by the frontend
# rm data.js
```

The `data/` folder is the **source of truth for the frontend**. `data.js` is an intermediate artifact only.
