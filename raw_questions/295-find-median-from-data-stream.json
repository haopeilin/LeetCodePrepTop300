{
  "questionId": "295",
  "questionFrontendId": "295",
  "title": "Find Median from Data Stream",
  "titleSlug": "find-median-from-data-stream",
  "content": "<p>The <strong>median</strong> is the middle value in an ordered integer list. If the size of the list is even, there is no middle value, and the median is the mean of the two middle values.</p>\n\n<ul>\n\t<li>For example, for <code>arr = [2,3,4]</code>, the median is <code>3</code>.</li>\n\t<li>For example, for <code>arr = [2,3]</code>, the median is <code>(2 + 3) / 2 = 2.5</code>.</li>\n</ul>\n\n<p>Implement the MedianFinder class:</p>\n\n<ul>\n\t<li><code>MedianFinder()</code> initializes the <code>MedianFinder</code> object.</li>\n\t<li><code>void addNum(int num)</code> adds the integer <code>num</code> from the data stream to the data structure.</li>\n\t<li><code>double findMedian()</code> returns the median of all elements so far. Answers within <code>10<sup>-5</sup></code> of the actual answer will be accepted.</li>\n</ul>\n\n<p>&nbsp;</p>\n<p><strong class=\"example\">Example 1:</strong></p>\n\n<pre>\n<strong>Input</strong>\n[&quot;MedianFinder&quot;, &quot;addNum&quot;, &quot;addNum&quot;, &quot;findMedian&quot;, &quot;addNum&quot;, &quot;findMedian&quot;]\n[[], [1], [2], [], [3], []]\n<strong>Output</strong>\n[null, null, null, 1.5, null, 2.0]\n\n<strong>Explanation</strong>\nMedianFinder medianFinder = new MedianFinder();\nmedianFinder.addNum(1);    // arr = [1]\nmedianFinder.addNum(2);    // arr = [1, 2]\nmedianFinder.findMedian(); // return 1.5 (i.e., (1 + 2) / 2)\nmedianFinder.addNum(3);    // arr[1, 2, 3]\nmedianFinder.findMedian(); // return 2.0\n</pre>\n\n<p>&nbsp;</p>\n<p><strong>Constraints:</strong></p>\n\n<ul>\n\t<li><code>-10<sup>5</sup> &lt;= num &lt;= 10<sup>5</sup></code></li>\n\t<li>There will be at least one element in the data structure before calling <code>findMedian</code>.</li>\n\t<li>At most <code>5 * 10<sup>4</sup></code> calls will be made to <code>addNum</code> and <code>findMedian</code>.</li>\n</ul>\n\n<p>&nbsp;</p>\n<p><strong>Follow up:</strong></p>\n\n<ul>\n\t<li>If all integer numbers from the stream are in the range <code>[0, 100]</code>, how would you optimize your solution?</li>\n\t<li>If <code>99%</code> of all integer numbers from the stream are in the range <code>[0, 100]</code>, how would you optimize your solution?</li>\n</ul>\n",
  "difficulty": "Hard",
  "stats": "{\"totalAccepted\": \"1.2M\", \"totalSubmission\": \"2.2M\", \"totalAcceptedRaw\": 1169786, \"totalSubmissionRaw\": 2160314, \"acRate\": \"54.1%\"}",
  "hints": [],
  "similarQuestions": "[{\"title\": \"Sliding Window Median\", \"titleSlug\": \"sliding-window-median\", \"difficulty\": \"Hard\", \"translatedTitle\": null}, {\"title\": \"Finding MK Average\", \"titleSlug\": \"finding-mk-average\", \"difficulty\": \"Hard\", \"translatedTitle\": null}, {\"title\": \"Sequentially Ordinal Rank Tracker\", \"titleSlug\": \"sequentially-ordinal-rank-tracker\", \"difficulty\": \"Hard\", \"translatedTitle\": null}, {\"title\": \"Minimum Operations to Make Median of Array Equal to K\", \"titleSlug\": \"minimum-operations-to-make-median-of-array-equal-to-k\", \"difficulty\": \"Medium\", \"translatedTitle\": null}, {\"title\": \"Minimum Operations to Make Subarray Elements Equal\", \"titleSlug\": \"minimum-operations-to-make-subarray-elements-equal\", \"difficulty\": \"Medium\", \"translatedTitle\": null}, {\"title\": \"Minimum Operations to Make Elements Within K Subarrays Equal\", \"titleSlug\": \"minimum-operations-to-make-elements-within-k-subarrays-equal\", \"difficulty\": \"Hard\", \"translatedTitle\": null}]",
  "topicTags": [
    {
      "name": "Two Pointers",
      "slug": "two-pointers"
    },
    {
      "name": "Design",
      "slug": "design"
    },
    {
      "name": "Sorting",
      "slug": "sorting"
    },
    {
      "name": "Heap (Priority Queue)",
      "slug": "heap-priority-queue"
    },
    {
      "name": "Data Stream",
      "slug": "data-stream"
    }
  ],
  "companyTags": null,
  "codeSnippets": [
    {
      "lang": "C++",
      "langSlug": "cpp",
      "code": "class MedianFinder {\npublic:\n    MedianFinder() {\n        \n    }\n    \n    void addNum(int num) {\n        \n    }\n    \n    double findMedian() {\n        \n    }\n};\n\n/**\n * Your MedianFinder object will be instantiated and called as such:\n * MedianFinder* obj = new MedianFinder();\n * obj->addNum(num);\n * double param_2 = obj->findMedian();\n */"
    },
    {
      "lang": "Java",
      "langSlug": "java",
      "code": "class MedianFinder {\n\n    public MedianFinder() {\n        \n    }\n    \n    public void addNum(int num) {\n        \n    }\n    \n    public double findMedian() {\n        \n    }\n}\n\n/**\n * Your MedianFinder object will be instantiated and called as such:\n * MedianFinder obj = new MedianFinder();\n * obj.addNum(num);\n * double param_2 = obj.findMedian();\n */"
    },
    {
      "lang": "Python3",
      "langSlug": "python3",
      "code": "class MedianFinder:\n\n    def __init__(self):\n        \n\n    def addNum(self, num: int) -> None:\n        \n\n    def findMedian(self) -> float:\n        \n\n\n# Your MedianFinder object will be instantiated and called as such:\n# obj = MedianFinder()\n# obj.addNum(num)\n# param_2 = obj.findMedian()"
    },
    {
      "lang": "Python",
      "langSlug": "python",
      "code": "class MedianFinder(object):\n\n    def __init__(self):\n        \n\n    def addNum(self, num):\n        \"\"\"\n        :type num: int\n        :rtype: None\n        \"\"\"\n        \n\n    def findMedian(self):\n        \"\"\"\n        :rtype: float\n        \"\"\"\n        \n\n\n# Your MedianFinder object will be instantiated and called as such:\n# obj = MedianFinder()\n# obj.addNum(num)\n# param_2 = obj.findMedian()"
    },
    {
      "lang": "JavaScript",
      "langSlug": "javascript",
      "code": "\nvar MedianFinder = function() {\n    \n};\n\n/** \n * @param {number} num\n * @return {void}\n */\nMedianFinder.prototype.addNum = function(num) {\n    \n};\n\n/**\n * @return {number}\n */\nMedianFinder.prototype.findMedian = function() {\n    \n};\n\n/** \n * Your MedianFinder object will be instantiated and called as such:\n * var obj = new MedianFinder()\n * obj.addNum(num)\n * var param_2 = obj.findMedian()\n */"
    },
    {
      "lang": "TypeScript",
      "langSlug": "typescript",
      "code": "class MedianFinder {\n    constructor() {\n        \n    }\n\n    addNum(num: number): void {\n        \n    }\n\n    findMedian(): number {\n        \n    }\n}\n\n/**\n * Your MedianFinder object will be instantiated and called as such:\n * var obj = new MedianFinder()\n * obj.addNum(num)\n * var param_2 = obj.findMedian()\n */"
    },
    {
      "lang": "C#",
      "langSlug": "csharp",
      "code": "public class MedianFinder {\n\n    public MedianFinder() {\n        \n    }\n    \n    public void AddNum(int num) {\n        \n    }\n    \n    public double FindMedian() {\n        \n    }\n}\n\n/**\n * Your MedianFinder object will be instantiated and called as such:\n * MedianFinder obj = new MedianFinder();\n * obj.AddNum(num);\n * double param_2 = obj.FindMedian();\n */"
    },
    {
      "lang": "C",
      "langSlug": "c",
      "code": "\n\n\ntypedef struct {\n    \n} MedianFinder;\n\n\nMedianFinder* medianFinderCreate() {\n    \n}\n\nvoid medianFinderAddNum(MedianFinder* obj, int num) {\n    \n}\n\ndouble medianFinderFindMedian(MedianFinder* obj) {\n    \n}\n\nvoid medianFinderFree(MedianFinder* obj) {\n    \n}\n\n/**\n * Your MedianFinder struct will be instantiated and called as such:\n * MedianFinder* obj = medianFinderCreate();\n * medianFinderAddNum(obj, num);\n \n * double param_2 = medianFinderFindMedian(obj);\n \n * medianFinderFree(obj);\n*/"
    },
    {
      "lang": "Go",
      "langSlug": "golang",
      "code": "type MedianFinder struct {\n    \n}\n\n\nfunc Constructor() MedianFinder {\n    \n}\n\n\nfunc (this *MedianFinder) AddNum(num int)  {\n    \n}\n\n\nfunc (this *MedianFinder) FindMedian() float64 {\n    \n}\n\n\n/**\n * Your MedianFinder object will be instantiated and called as such:\n * obj := Constructor();\n * obj.AddNum(num);\n * param_2 := obj.FindMedian();\n */"
    },
    {
      "lang": "Kotlin",
      "langSlug": "kotlin",
      "code": "class MedianFinder() {\n\n    fun addNum(num: Int) {\n        \n    }\n\n    fun findMedian(): Double {\n        \n    }\n\n}\n\n/**\n * Your MedianFinder object will be instantiated and called as such:\n * var obj = MedianFinder()\n * obj.addNum(num)\n * var param_2 = obj.findMedian()\n */"
    },
    {
      "lang": "Swift",
      "langSlug": "swift",
      "code": "\nclass MedianFinder {\n\n    init() {\n        \n    }\n    \n    func addNum(_ num: Int) {\n        \n    }\n    \n    func findMedian() -> Double {\n        \n    }\n}\n\n/**\n * Your MedianFinder object will be instantiated and called as such:\n * let obj = MedianFinder()\n * obj.addNum(num)\n * let ret_2: Double = obj.findMedian()\n */"
    },
    {
      "lang": "Rust",
      "langSlug": "rust",
      "code": "struct MedianFinder {\n\n}\n\n\n/** \n * `&self` means the method takes an immutable reference.\n * If you need a mutable reference, change it to `&mut self` instead.\n */\nimpl MedianFinder {\n\n    fn new() -> Self {\n        \n    }\n    \n    fn add_num(&self, num: i32) {\n        \n    }\n    \n    fn find_median(&self) -> f64 {\n        \n    }\n}\n\n/**\n * Your MedianFinder object will be instantiated and called as such:\n * let obj = MedianFinder::new();\n * obj.add_num(num);\n * let ret_2: f64 = obj.find_median();\n */"
    },
    {
      "lang": "Ruby",
      "langSlug": "ruby",
      "code": "class MedianFinder\n    def initialize()\n        \n    end\n\n\n=begin\n    :type num: Integer\n    :rtype: Void\n=end\n    def add_num(num)\n        \n    end\n\n\n=begin\n    :rtype: Float\n=end\n    def find_median()\n        \n    end\n\n\nend\n\n# Your MedianFinder object will be instantiated and called as such:\n# obj = MedianFinder.new()\n# obj.add_num(num)\n# param_2 = obj.find_median()"
    },
    {
      "lang": "PHP",
      "langSlug": "php",
      "code": "class MedianFinder {\n    /**\n     */\n    function __construct() {\n        \n    }\n  \n    /**\n     * @param Integer $num\n     * @return NULL\n     */\n    function addNum($num) {\n        \n    }\n  \n    /**\n     * @return Float\n     */\n    function findMedian() {\n        \n    }\n}\n\n/**\n * Your MedianFinder object will be instantiated and called as such:\n * $obj = MedianFinder();\n * $obj->addNum($num);\n * $ret_2 = $obj->findMedian();\n */"
    },
    {
      "lang": "Dart",
      "langSlug": "dart",
      "code": "class MedianFinder {\n\n  MedianFinder() {\n    \n  }\n  \n  void addNum(int num) {\n    \n  }\n  \n  double findMedian() {\n    \n  }\n}\n\n/**\n * Your MedianFinder object will be instantiated and called as such:\n * MedianFinder obj = MedianFinder();\n * obj.addNum(num);\n * double param2 = obj.findMedian();\n */"
    },
    {
      "lang": "Scala",
      "langSlug": "scala",
      "code": "class MedianFinder() {\n\n    def addNum(num: Int): Unit = {\n        \n    }\n\n    def findMedian(): Double = {\n        \n    }\n\n}\n\n/**\n * Your MedianFinder object will be instantiated and called as such:\n * val obj = new MedianFinder()\n * obj.addNum(num)\n * val param_2 = obj.findMedian()\n */"
    },
    {
      "lang": "Elixir",
      "langSlug": "elixir",
      "code": "defmodule MedianFinder do\n  @spec init_() :: any\n  def init_() do\n    \n  end\n\n  @spec add_num(num :: integer) :: any\n  def add_num(num) do\n    \n  end\n\n  @spec find_median() :: float\n  def find_median() do\n    \n  end\nend\n\n# Your functions will be called as such:\n# MedianFinder.init_()\n# MedianFinder.add_num(num)\n# param_2 = MedianFinder.find_median()\n\n# MedianFinder.init_ will be called before every test case, in which you can do some necessary initializations."
    },
    {
      "lang": "Erlang",
      "langSlug": "erlang",
      "code": "-spec median_finder_init_() -> any().\nmedian_finder_init_() ->\n  .\n\n-spec median_finder_add_num(Num :: integer()) -> any().\nmedian_finder_add_num(Num) ->\n  .\n\n-spec median_finder_find_median() -> float().\nmedian_finder_find_median() ->\n  .\n\n\n%% Your functions will be called as such:\n%% median_finder_init_(),\n%% median_finder_add_num(Num),\n%% Param_2 = median_finder_find_median(),\n\n%% median_finder_init_ will be called before every test case, in which you can do some necessary initializations."
    },
    {
      "lang": "Racket",
      "langSlug": "racket",
      "code": "(define median-finder%\n  (class object%\n    (super-new)\n    \n    (init-field)\n    \n    ; add-num : exact-integer? -> void?\n    (define/public (add-num num)\n      )\n    ; find-median : -> flonum?\n    (define/public (find-median)\n      )))\n\n;; Your median-finder% object will be instantiated and called as such:\n;; (define obj (new median-finder%))\n;; (send obj add-num num)\n;; (define param_2 (send obj find-median))"
    }
  ],
  "solution": {
    "content": "<div class=\"flex flex-col w-full\" style=\"position: relative;\"><div class=\"mYe_l WRmCx\"><h2 id=\"solution\" level=\"2\" class=\"group/heading relative\"><a href=\"#solution\" class=\"!text-sd-muted-foreground absolute right-full top-1/2 -translate-y-1/2 cursor-pointer pr-0.5 text-xs opacity-0 group-hover/heading:opacity-100\" aria-hidden=\"true\" tabindex=\"-1\"><div class=\"relative text-[12px] leading-[normal] p-[1px] before:block before:h-3 before:w-3\"><svg aria-hidden=\"true\" focusable=\"false\" data-prefix=\"fas\" data-icon=\"link\" class=\"svg-inline--fa fa-link absolute left-1/2 top-1/2 h-[1em] -translate-x-1/2 -translate-y-1/2 align-[-0.125em]\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 640 512\" spacing=\"square\"><path fill=\"currentColor\" d=\"M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z\"></path></svg></div></a>Solution</h2>\n<hr>\n<h3 id=\"approach-1-simple-sorting\" level=\"3\" class=\"group/heading relative\"><a href=\"#approach-1-simple-sorting\" class=\"!text-sd-muted-foreground absolute right-full top-1/2 -translate-y-1/2 cursor-pointer pr-0.5 text-xs opacity-0 group-hover/heading:opacity-100\" aria-hidden=\"true\" tabindex=\"-1\"><div class=\"relative text-[12px] leading-[normal] p-[1px] before:block before:h-3 before:w-3\"><svg aria-hidden=\"true\" focusable=\"false\" data-prefix=\"fas\" data-icon=\"link\" class=\"svg-inline--fa fa-link absolute left-1/2 top-1/2 h-[1em] -translate-x-1/2 -translate-y-1/2 align-[-0.125em]\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 640 512\" spacing=\"square\"><path fill=\"currentColor\" d=\"M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z\"></path></svg></div></a>Approach 1: Simple Sorting</h3>\n<p><strong>Intuition</strong></p>\n<p>Do what the question says.</p>\n<p><strong>Algorithm</strong></p>\n<p>Store the numbers in a resize-able container. Every time you need to output the median, sort the container and output the median.</p>\n<pre><code>class MedianFinder {\n    vector&lt;int&gt; store;\n​\npublic:\n    // Adds a number into the data structure.\n    void addNum(int num)\n    {\n        store.push_back(num);\n    }\n​\n    // Returns the median of current data stream\n    double findMedian()\n    {\n        sort(store.begin(), store.end());\n​\n        int n = store.size();\n        return (n & 1 ? store[n / 2] : ((double) store[n / 2 - 1] + store[n / 2]) * 0.5);\n    }\n};</code></pre>\n<p><strong>Complexity Analysis</strong></p>\n<ul>\n<li>\n<p>Time complexity: <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height: 1em; vertical-align: -0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right: 0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right: 0.1667em;\"></span><span class=\"mop\">lo<span style=\"margin-right: 0.01389em;\">g</span></span><span class=\"mspace\" style=\"margin-right: 0.1667em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right: 0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right: 0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height: 1em; vertical-align: -0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right: 0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord\">1</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right: 0.2778em;\"></span><span class=\"mrel\">≃</span><span class=\"mspace\" style=\"margin-right: 0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height: 1em; vertical-align: -0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right: 0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right: 0.1667em;\"></span><span class=\"mop\">lo<span style=\"margin-right: 0.01389em;\">g</span></span><span class=\"mspace\" style=\"margin-right: 0.1667em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span></span>.</p>\n<ul>\n<li>Adding a number takes amortized <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height: 1em; vertical-align: -0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right: 0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord\">1</span><span class=\"mclose\">)</span></span></span></span></span> time for a container with an efficient resizing scheme.</li>\n<li>Finding the median is primarily dependent on the sorting that takes place. This takes <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height: 1em; vertical-align: -0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right: 0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right: 0.1667em;\"></span><span class=\"mop\">lo<span style=\"margin-right: 0.01389em;\">g</span></span><span class=\"mspace\" style=\"margin-right: 0.1667em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span></span> time for a standard comparative sort.</li>\n</ul>\n</li>\n<li>\n<p>Space complexity: <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height: 1em; vertical-align: -0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right: 0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span></span> linear space to hold input in a container. No extra space other than that needed (since sorting can usually be done in-place).</p>\n</li>\n</ul>\n<hr>\n<h3 id=\"approach-2-insertion-sort\" level=\"3\" class=\"group/heading relative\"><a href=\"#approach-2-insertion-sort\" class=\"!text-sd-muted-foreground absolute right-full top-1/2 -translate-y-1/2 cursor-pointer pr-0.5 text-xs opacity-0 group-hover/heading:opacity-100\" aria-hidden=\"true\" tabindex=\"-1\"><div class=\"relative text-[12px] leading-[normal] p-[1px] before:block before:h-3 before:w-3\"><svg aria-hidden=\"true\" focusable=\"false\" data-prefix=\"fas\" data-icon=\"link\" class=\"svg-inline--fa fa-link absolute left-1/2 top-1/2 h-[1em] -translate-x-1/2 -translate-y-1/2 align-[-0.125em]\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 640 512\" spacing=\"square\"><path fill=\"currentColor\" d=\"M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z\"></path></svg></div></a>Approach 2: Insertion Sort</h3>\n<p><strong>Intuition</strong></p>\n<p>Keeping our input container always sorted (i.e. maintaining the sorted nature of the container as an <em>invariant</em>).</p>\n<p><strong>Algorithm</strong></p>\n<p>Which algorithm allows a number to be added to a sorted list of numbers and yet keeps the entire list sorted? Well, for one, <strong>insertion sort!</strong></p>\n<p>We assume that the current list is already sorted. When a new number comes, we have to add it to the list while maintaining the sorted nature of the list. This is achieved easily by finding the correct place to insert the incoming number, using a <strong>binary search</strong> (remember, the list is <em>always sorted</em>). Once the position is found, we need to shift all higher elements by one space to make room for the incoming number.</p>\n<p>This method would work well when the amount of insertion queries is lesser or about the same as the amount of median finding queries.</p>\n<pre><code>class MedianFinder {\n    vector&lt;int&gt; store; // resize-able container\n​\npublic:\n    // Adds a number into the data structure.\n    void addNum(int num)\n    {\n        if (store.empty())\n            store.push_back(num);\n        else\n            store.insert(lower_bound(store.begin(), store.end(), num), num);     // binary search and insertion combined\n    }\n​\n    // Returns the median of current data stream\n    double findMedian()\n    {\n        int n = store.size();\n        return n & 1 ? store[n / 2] : ((double) store[n / 2 - 1] + store[n / 2]) * 0.5;\n    }\n};</code></pre>\n<p><strong>Complexity Analysis</strong></p>\n<ul>\n<li>\n<p>Time complexity: <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height: 1em; vertical-align: -0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right: 0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right: 0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right: 0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height: 1em; vertical-align: -0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right: 0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mop\">lo<span style=\"margin-right: 0.01389em;\">g</span></span><span class=\"mspace\" style=\"margin-right: 0.1667em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right: 0.2778em;\"></span><span class=\"mrel\">≈</span><span class=\"mspace\" style=\"margin-right: 0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height: 1em; vertical-align: -0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right: 0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span></span>.</p>\n<ul>\n<li>Binary Search takes <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height: 1em; vertical-align: -0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right: 0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mop\">lo<span style=\"margin-right: 0.01389em;\">g</span></span><span class=\"mspace\" style=\"margin-right: 0.1667em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span></span> time to find correct insertion position.</li>\n<li>Insertion can take up to <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height: 1em; vertical-align: -0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right: 0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span></span> time since elements have to be shifted inside the container to make room for the new element.</li>\n</ul>\n</li>\n</ul>\n<blockquote>\n<p><strong>Pop quiz:</strong> Can we use a <em>linear</em> search instead of a <em>binary</em> search to find insertion position, without incurring any significant runtime penalty?</p>\n</blockquote>\n<ul>\n<li>Space complexity: <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height: 1em; vertical-align: -0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right: 0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span></span> linear space to hold input in a container.</li>\n</ul>\n<hr>\n<h3 id=\"approach-3-two-heaps\" level=\"3\" class=\"group/heading relative\"><a href=\"#approach-3-two-heaps\" class=\"!text-sd-muted-foreground absolute right-full top-1/2 -translate-y-1/2 cursor-pointer pr-0.5 text-xs opacity-0 group-hover/heading:opacity-100\" aria-hidden=\"true\" tabindex=\"-1\"><div class=\"relative text-[12px] leading-[normal] p-[1px] before:block before:h-3 before:w-3\"><svg aria-hidden=\"true\" focusable=\"false\" data-prefix=\"fas\" data-icon=\"link\" class=\"svg-inline--fa fa-link absolute left-1/2 top-1/2 h-[1em] -translate-x-1/2 -translate-y-1/2 align-[-0.125em]\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 640 512\" spacing=\"square\"><path fill=\"currentColor\" d=\"M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z\"></path></svg></div></a>Approach 3: Two Heaps</h3>\n<p><strong>Intuition</strong></p>\n<p>The above two approaches gave us some valuable insights on how to tackle this problem. Concretely, one can infer two things:</p>\n<ol>\n<li data-length=\"1\">If we could maintain direct access to median elements at all times, then finding the median would take a constant amount of time.</li>\n<li data-length=\"1\">If we could find a reasonably fast way of adding numbers to our containers, additional penalties incurred could be lessened.</li>\n</ol>\n<p>But perhaps the most important insight, which is not readily observable, is the fact that we <em>only</em> need a consistent way to access the median elements. Keeping the <em>entire</em> input sorted is <strong>not a requirement.</strong></p>\n<blockquote>\n<p>Well, if only there were a data structure which could handle our needs.</p>\n</blockquote>\n<p>As it turns out there are two data structures for the job:</p>\n<ul>\n<li>Heaps (or Priority Queues <sup><a href=\"#user-content-fn-note-1\" id=\"user-content-fnref-note-1\" aria-describedby=\"footnote-label\" rel=\"noopener noreferrer nofollow ugc\" target=\"_self\">1</a></sup>)</li>\n<li>Self-balancing Binary Search Trees (we'll talk more about them in <a href=\"#approach-4-multiset-and-two-pointers\" rel=\"noopener noreferrer nofollow ugc\" target=\"_self\">Approach 4</a>)</li>\n</ul>\n<p>Heaps are a natural ingredient for this dish! Adding elements to them take logarithmic order of time. They also give direct access to the maximal/minimal elements in a group.</p>\n<p>If we could maintain <em>two</em> heaps in the following way:</p>\n<ul>\n<li>A max-heap to store the smaller half of the input numbers</li>\n<li>A min-heap to store the larger half of the input numbers</li>\n</ul>\n<p>This gives access to median values in the input: they comprise the top of the heaps!</p>\n<p><strong>Wait, what? How?</strong></p>\n<p>If the following conditions are met:</p>\n<ol>\n<li data-length=\"1\">Both the heaps are balanced (or nearly balanced)</li>\n<li data-length=\"1\">The max-heap contains all the smaller numbers while the min-heap contains all the larger numbers</li>\n</ol>\n<p>then we can say that:</p>\n<ol>\n<li data-length=\"1\">All the numbers in the max-heap are smaller or equal to the top element of the max-heap (let's call it <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height: 0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span></span>)</li>\n<li data-length=\"1\">All the numbers in the min-heap are larger or equal to the top element of the min-heap (let's call it <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height: 0.625em; vertical-align: -0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right: 0.03588em;\">y</span></span></span></span></span>)</li>\n</ol>\n<p>Then <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height: 0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span></span> and/or <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height: 0.625em; vertical-align: -0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right: 0.03588em;\">y</span></span></span></span></span> are smaller than (or equal to) almost half of the elements and larger than (or equal to) the other half. That is <em>the</em> definition of <strong>median</strong> elements.</p>\n<p>This leads us to a huge point of pain in this approach: <strong>balancing the two heaps!</strong></p>\n<p><strong>Algorithm</strong></p>\n<ul>\n<li>\n<p>Two priority queues:</p>\n<ol>\n<li data-length=\"1\">A max-heap <code>lo</code> to store the smaller half of the numbers</li>\n<li data-length=\"1\">A min-heap <code>hi</code> to store the larger half of the numbers</li>\n</ol>\n</li>\n<li>\n<p>The max-heap <code>lo</code> is allowed to store, at worst, one more element more than the min-heap <code>hi</code>. Hence if we have processed <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height: 0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right: 0.03148em;\">k</span></span></span></span></span> elements:</p>\n<ul>\n<li>If <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height: 0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right: 0.03148em;\">k</span><span class=\"mspace\" style=\"margin-right: 0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right: 0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height: 0.6444em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right: 0.2222em;\"></span><span class=\"mbin\">∗</span><span class=\"mspace\" style=\"margin-right: 0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height: 0.6667em; vertical-align: -0.0833em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right: 0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right: 0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height: 1em; vertical-align: -0.25em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right: 1em;\"></span><span class=\"mopen\">(</span><span class=\"mord\">∀</span><span class=\"mspace\" style=\"margin-right: 0.1667em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right: 0.2778em;\"></span><span class=\"mrel\">∈</span><span class=\"mspace\" style=\"margin-right: 0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height: 1em; vertical-align: -0.25em;\"></span><span class=\"mord mathbb\">Z</span><span class=\"mclose\">)</span></span></span></span></span>, then <code>lo</code> is allowed to hold <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height: 0.6667em; vertical-align: -0.0833em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right: 0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right: 0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height: 0.6444em;\"></span><span class=\"mord\">1</span></span></span></span></span> elements, while <code>hi</code> can hold <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height: 0.4306em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span></span> elements.</li>\n<li>If <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height: 0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right: 0.03148em;\">k</span><span class=\"mspace\" style=\"margin-right: 0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right: 0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height: 0.6444em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right: 0.2222em;\"></span><span class=\"mbin\">∗</span><span class=\"mspace\" style=\"margin-right: 0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height: 1em; vertical-align: -0.25em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right: 1em;\"></span><span class=\"mopen\">(</span><span class=\"mord\">∀</span><span class=\"mspace\" style=\"margin-right: 0.1667em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right: 0.2778em;\"></span><span class=\"mrel\">∈</span><span class=\"mspace\" style=\"margin-right: 0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height: 1em; vertical-align: -0.25em;\"></span><span class=\"mord mathbb\">Z</span><span class=\"mclose\">)</span></span></span></span></span>, then both heaps are balanced and hold <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height: 0.4306em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span></span> elements each.</li>\n</ul>\n<p>This gives us the nice property that when the heaps are perfectly balanced, the median can be derived from the tops of both heaps. Otherwise, the top of the max-heap <code>lo</code> holds the legitimate median.</p>\n</li>\n<li>\n<p>Adding a number <code>num</code>:</p>\n<ul>\n<li>Add <code>num</code> to max-heap <code>lo</code>. Since <code>lo</code> received a new element, we must do a balancing step for <code>hi</code>. So remove the largest element from <code>lo</code> and offer it to <code>hi</code>.</li>\n<li>The min-heap <code>hi</code> might end holding more elements than the max-heap <code>lo</code>, after the previous operation. We fix that by removing the smallest element from <code>hi</code> and offering it to <code>lo</code>.</li>\n</ul>\n<p>The above step ensures that we do not disturb the nice little size property we just mentioned.</p>\n</li>\n</ul>\n<p>A little example will clear this up! Say we take input from the stream <code>[41, 35, 62, 5, 97, 108]</code>. The run-though of the algorithm looks like this:</p>\n<div class=\"font-menlo mb-6 rounded-lg px-3 py-2.5 text-sm bg-fill-3 dark:bg-dark-fill-3\"><div class=\"group relative\" translate=\"no\"><pre style=\"color: black; font-size: 13px; text-shadow: none; font-family: Menlo, Monaco, Consolas; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 4; hyphens: none; padding: 0px; margin: 0px; overflow: auto; background: transparent; overflow-wrap: normal;\"><code class=\"language-r\" style=\"white-space: pre; text-shadow: none;\"><span><span>Adding number </span><span class=\"token\" style=\"color: rgb(153, 0, 85);\">41</span><span>\n</span></span><span><span>MaxHeap lo</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">:</span><span> </span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">[</span><span class=\"token\" style=\"color: rgb(153, 0, 85);\">41</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">]</span><span>           </span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">/</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">/</span><span> MaxHeap stores the largest value at the top </span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">(</span><span>index </span><span class=\"token\" style=\"color: rgb(153, 0, 85);\">0</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">)</span><span>\n</span></span><span><span>MinHeap hi</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">:</span><span> </span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">[</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">]</span><span>             </span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">/</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">/</span><span> MinHeap stores the smallest value at the top </span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">(</span><span>index </span><span class=\"token\" style=\"color: rgb(153, 0, 85);\">0</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">)</span><span>\n</span></span><span><span>Median is </span><span class=\"token\" style=\"color: rgb(153, 0, 85);\">41</span><span>\n</span></span><span><span></span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">==</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">==</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">==</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">==</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">==</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">==</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">==</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">==</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">==</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">==</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">==</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">=</span><span>\n</span></span><span><span>Adding number </span><span class=\"token\" style=\"color: rgb(153, 0, 85);\">35</span><span>\n</span></span><span><span>MaxHeap lo</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">:</span><span> </span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">[</span><span class=\"token\" style=\"color: rgb(153, 0, 85);\">35</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">]</span><span>\n</span></span><span><span>MinHeap hi</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">:</span><span> </span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">[</span><span class=\"token\" style=\"color: rgb(153, 0, 85);\">41</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">]</span><span>\n</span></span><span><span>Median is </span><span class=\"token\" style=\"color: rgb(153, 0, 85);\">38</span><span>\n</span></span><span><span></span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">==</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">==</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">==</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">==</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">==</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">==</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">==</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">==</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">==</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">==</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">==</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">=</span><span>\n</span></span><span><span>Adding number </span><span class=\"token\" style=\"color: rgb(153, 0, 85);\">62</span><span>\n</span></span><span><span>MaxHeap lo</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">:</span><span> </span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">[</span><span class=\"token\" style=\"color: rgb(153, 0, 85);\">41</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">,</span><span> </span><span class=\"token\" style=\"color: rgb(153, 0, 85);\">35</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">]</span><span>\n</span></span><span><span>MinHeap hi</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">:</span><span> </span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">[</span><span class=\"token\" style=\"color: rgb(153, 0, 85);\">62</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">]</span><span>\n</span></span><span><span>Median is </span><span class=\"token\" style=\"color: rgb(153, 0, 85);\">41</span><span>\n</span></span><span><span></span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">==</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">==</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">==</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">==</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">==</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">==</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">==</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">==</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">==</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">==</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">==</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">=</span><span>\n</span></span><span><span>Adding number </span><span class=\"token\" style=\"color: rgb(153, 0, 85);\">4</span><span>\n</span></span><span><span>MaxHeap lo</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">:</span><span> </span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">[</span><span class=\"token\" style=\"color: rgb(153, 0, 85);\">35</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">,</span><span> </span><span class=\"token\" style=\"color: rgb(153, 0, 85);\">4</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">]</span><span>\n</span></span><span><span>MinHeap hi</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">:</span><span> </span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">[</span><span class=\"token\" style=\"color: rgb(153, 0, 85);\">41</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">,</span><span> </span><span class=\"token\" style=\"color: rgb(153, 0, 85);\">62</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">]</span><span>\n</span></span><span><span>Median is </span><span class=\"token\" style=\"color: rgb(153, 0, 85);\">38</span><span>\n</span></span><span><span></span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">==</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">==</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">==</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">==</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">==</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">==</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">==</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">==</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">==</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">==</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">==</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">=</span><span>\n</span></span><span><span>Adding number </span><span class=\"token\" style=\"color: rgb(153, 0, 85);\">97</span><span>\n</span></span><span><span>MaxHeap lo</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">:</span><span> </span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">[</span><span class=\"token\" style=\"color: rgb(153, 0, 85);\">41</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">,</span><span> </span><span class=\"token\" style=\"color: rgb(153, 0, 85);\">35</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">,</span><span> </span><span class=\"token\" style=\"color: rgb(153, 0, 85);\">4</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">]</span><span>\n</span></span><span><span>MinHeap hi</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">:</span><span> </span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">[</span><span class=\"token\" style=\"color: rgb(153, 0, 85);\">62</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">,</span><span> </span><span class=\"token\" style=\"color: rgb(153, 0, 85);\">97</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">]</span><span>\n</span></span><span><span>Median is </span><span class=\"token\" style=\"color: rgb(153, 0, 85);\">41</span><span>\n</span></span><span><span></span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">==</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">==</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">==</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">==</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">==</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">==</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">==</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">==</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">==</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">==</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">==</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">=</span><span>\n</span></span><span><span>Adding number </span><span class=\"token\" style=\"color: rgb(153, 0, 85);\">108</span><span>\n</span></span><span><span>MaxHeap lo</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">:</span><span> </span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">[</span><span class=\"token\" style=\"color: rgb(153, 0, 85);\">41</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">,</span><span> </span><span class=\"token\" style=\"color: rgb(153, 0, 85);\">35</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">,</span><span> </span><span class=\"token\" style=\"color: rgb(153, 0, 85);\">4</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">]</span><span>\n</span></span><span><span>MinHeap hi</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">:</span><span> </span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">[</span><span class=\"token\" style=\"color: rgb(153, 0, 85);\">62</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">,</span><span> </span><span class=\"token\" style=\"color: rgb(153, 0, 85);\">97</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">,</span><span> </span><span class=\"token\" style=\"color: rgb(153, 0, 85);\">108</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">]</span><span>\n</span></span><span><span>Median is </span><span class=\"token\" style=\"color: rgb(153, 0, 85);\">51.5</span></span></code></pre><div class=\"absolute -right-1.5 -top-0.5 flex gap-2\"><div class=\"z-base-1 hidden rounded border group-hover:block border-border-quaternary dark:border-border-quaternary bg-layer-02 dark:bg-layer-02\"><div class=\"relative cursor-pointer flex h-[22px] w-[22px] items-center justify-center bg-layer-02 dark:bg-layer-02 hover:bg-fill-tertiary dark:hover:bg-fill-tertiary rounded-[4px]\" data-state=\"closed\"><div><div data-state=\"closed\"><div class=\"relative text-[12px] leading-[normal] p-[1px] before:block before:h-3 before:w-3 h-3.5 w-3.5 text-text-primary dark:text-text-primary\"><svg aria-hidden=\"true\" focusable=\"false\" data-prefix=\"far\" data-icon=\"clone\" class=\"svg-inline--fa fa-clone absolute left-1/2 top-1/2 h-[1em] -translate-x-1/2 -translate-y-1/2 align-[-0.125em]\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\"><path fill=\"currentColor\" d=\"M64 464H288c8.8 0 16-7.2 16-16V384h48v64c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V224c0-35.3 28.7-64 64-64h64v48H64c-8.8 0-16 7.2-16 16V448c0 8.8 7.2 16 16 16zM224 304H448c8.8 0 16-7.2 16-16V64c0-8.8-7.2-16-16-16H224c-8.8 0-16 7.2-16 16V288c0 8.8 7.2 16 16 16zm-64-16V64c0-35.3 28.7-64 64-64H448c35.3 0 64 28.7 64 64V288c0 35.3-28.7 64-64 64H224c-35.3 0-64-28.7-64-64z\"></path></svg></div></div></div></div></div></div></div></div>\n<pre><code>class MedianFinder {\n    priority_queue&lt;int&gt; lo;                              // max heap\n    priority_queue&lt;int, vector&lt;int&gt;, greater&lt;int&gt;&gt; hi;   // min heap\n​\npublic:\n    // Adds a number into the data structure.\n    void addNum(int num)\n    {\n        lo.push(num);                                    // Add to max heap\n​\n        hi.push(lo.top());                               // balancing step\n        lo.pop();\n​\n        if (lo.size() &lt; hi.size()) {                     // maintain size property\n            lo.push(hi.top());\n            hi.pop();\n        }\n    }\n​\n    // Returns the median of current data stream\n    double findMedian()\n    {\n        return lo.size() &gt; hi.size() ? lo.top() : ((double) lo.top() + hi.top()) * 0.5;\n    }\n};</code></pre>\n<p><strong>Complexity Analysis</strong></p>\n<ul>\n<li>\n<p>Time complexity: <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height: 1em; vertical-align: -0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right: 0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord\">5</span><span class=\"mspace\" style=\"margin-right: 0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right: 0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height: 1em; vertical-align: -0.25em;\"></span><span class=\"mop\">lo<span style=\"margin-right: 0.01389em;\">g</span></span><span class=\"mspace\" style=\"margin-right: 0.1667em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right: 0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right: 0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height: 1em; vertical-align: -0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right: 0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord\">1</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right: 0.2778em;\"></span><span class=\"mrel\">≈</span><span class=\"mspace\" style=\"margin-right: 0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height: 1em; vertical-align: -0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right: 0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mop\">lo<span style=\"margin-right: 0.01389em;\">g</span></span><span class=\"mspace\" style=\"margin-right: 0.1667em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span></span>.</p>\n<ul>\n<li>At worst, there are three heap insertions and two heap deletions from the top. Each of these takes about <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height: 1em; vertical-align: -0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right: 0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mop\">lo<span style=\"margin-right: 0.01389em;\">g</span></span><span class=\"mspace\" style=\"margin-right: 0.1667em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span></span> time.</li>\n<li>Finding the median takes constant <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height: 1em; vertical-align: -0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right: 0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord\">1</span><span class=\"mclose\">)</span></span></span></span></span> time since the tops of heaps are directly accessible.</li>\n</ul>\n</li>\n<li>\n<p>Space complexity: <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height: 1em; vertical-align: -0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right: 0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span></span> linear space to hold input in containers.</p>\n</li>\n</ul>\n<hr>\n<h3 id=\"approach-4-multiset-and-two-pointers\" level=\"3\" class=\"group/heading relative\"><a href=\"#approach-4-multiset-and-two-pointers\" class=\"!text-sd-muted-foreground absolute right-full top-1/2 -translate-y-1/2 cursor-pointer pr-0.5 text-xs opacity-0 group-hover/heading:opacity-100\" aria-hidden=\"true\" tabindex=\"-1\"><div class=\"relative text-[12px] leading-[normal] p-[1px] before:block before:h-3 before:w-3\"><svg aria-hidden=\"true\" focusable=\"false\" data-prefix=\"fas\" data-icon=\"link\" class=\"svg-inline--fa fa-link absolute left-1/2 top-1/2 h-[1em] -translate-x-1/2 -translate-y-1/2 align-[-0.125em]\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 640 512\" spacing=\"square\"><path fill=\"currentColor\" d=\"M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z\"></path></svg></div></a>Approach 4: Multiset and Two Pointers</h3>\n<p><strong>Intuition</strong></p>\n<p>Self-balancing Binary Search Trees (like an <a href=\"https://en.wikipedia.org/wiki/AVL_tree\" target=\"_blank\">AVL Tree</a>) have some <em>very</em> interesting properties. They maintain the tree's height to a logarithmic bound. Thus inserting a new element has reasonably good time performance. The median <strong>always</strong> winds up in the root of the tree and/or one of its children. Solving this problem using the same approach as <a href=\"#approach-3-two-heaps\" rel=\"noopener noreferrer nofollow ugc\" target=\"_self\">Approach 3</a> but using a Self-balancing BST seems like a good choice. Except the fact that implementing such a tree is not trivial and prone to errors.</p>\n<p><em>Why reinvent the wheel?</em> Most languages implement a <code>multiset</code> class which emulates such behavior. The only problem remains keeping track of the median elements. That is easily solved with <strong>pointers!</strong> <sup><a href=\"#user-content-fn-note-2\" id=\"user-content-fnref-note-2\" aria-describedby=\"footnote-label\" rel=\"noopener noreferrer nofollow ugc\" target=\"_self\">2</a></sup></p>\n<p>We maintain two pointers: one for the lower median element and the other for the higher median element. When the total number of elements is odd, both the pointers point to the same median element (since there is only one median in this case). When the number of elements is even, the pointers point to two consecutive elements, whose mean is the representative median of the input.</p>\n<p><strong>Algorithm</strong></p>\n<ul>\n<li>\n<p>Two iterators/pointers <code>lo_median</code> and <code>hi_median</code>, which iterate over the <code>data</code> multiset.</p>\n</li>\n<li>\n<p>While adding a number <code>num</code>, three cases arise:</p>\n<ol>\n<li data-length=\"1\">\n<p>The container is currently <strong>empty.</strong> Hence we simply insert <code>num</code> and set both pointers to point to this element.</p>\n</li>\n<li data-length=\"1\">\n<p>The container currently holds an <strong>odd</strong> number of elements. This means that both the pointers currently point to the same element.</p>\n<ul>\n<li>If <code>num</code> is not equal to the current median element, then <code>num</code> goes on either side of it. Whichever side it goes, the size of that part increases and hence the corresponding pointer is updated. For example, if <code>num</code> is less than the median element, the size of the lesser half of input increases by <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height: 0.6444em;\"></span><span class=\"mord\">1</span></span></span></span></span> on inserting <code>num</code>. Thus it makes sense to decrement <code>lo_median</code>.</li>\n<li>If <code>num</code> is equal to the current median element, then the action taken is dependent on how <code>num</code> is inserted into <code>data</code>. <strong>NOTE:</strong> In our given C++ code example, <code>std::multiset::insert</code> inserts an element <em>after</em> all elements of equal value. Hence we increment <code>hi_median</code>.</li>\n</ul>\n</li>\n<li data-length=\"1\">\n<p>The container currently holds an <strong>even</strong> number of elements. This means that the pointers currently point to consecutive elements.</p>\n<ul>\n<li>If <code>num</code> is a number between both median elements, then <code>num</code> becomes the new median. Both pointers must point to it.</li>\n<li>Otherwise, <code>num</code> increases the size of either the lesser or higher half of the input. We update the pointers accordingly. It is important to remember that both the pointers <em><strong>must</strong></em> point to the same element now.</li>\n</ul>\n</li>\n</ol>\n</li>\n<li>\n<p>Finding the median is easy! It is simply the <strong>mean</strong> of the elements pointed to by the two pointers <code>lo_median</code> and <code>hi_median</code>.</p>\n</li>\n</ul>\n<pre><code>class MedianFinder {\n    multiset&lt;int&gt; data;\n    multiset&lt;int&gt;::iterator lo_median, hi_median;\n​\npublic:\n    MedianFinder()\n        : lo_median(data.end())\n        , hi_median(data.end())\n    {\n    }\n​\n    void addNum(int num)\n    {\n        const size_t n = data.size();   // store previous size\n​\n        data.insert(num);               // insert into multiset\n​\n        if (!n) {\n            // no elements before, one element now\n            lo_median = hi_median = data.begin();\n        }\n        else if (n & 1) {\n            // odd size before (i.e. lo == hi), even size now (i.e. hi = lo + 1)\n​\n            if (num &lt; *lo_median)       // num &lt; lo\n                lo_median--;\n            else                        // num &gt;= hi\n                hi_median++;            // insertion at end of equal range\n        }\n        else {\n            // even size before (i.e. hi = lo + 1), odd size now (i.e. lo == hi)\n​\n            if (num &gt; *lo_median && num &lt; *hi_median) {\n                lo_median++;                    // num in between lo and hi\n                hi_median--;\n            }\n            else if (num &gt;= *hi_median)         // num inserted after hi\n                lo_median++;\n            else                                // num &lt;= lo &lt; hi\n                lo_median = --hi_median;        // insertion at end of equal range spoils lo\n        }\n    }\n​\n    double findMedian()\n    {\n        return ((double) *lo_median + *hi_median) * 0.5;\n    }\n};</code></pre>\n<p>A much shorter (but harder to understand), <em><strong>one</strong></em> <em>pointer</em> version <sup><a href=\"#user-content-fn-note-3\" id=\"user-content-fnref-note-3\" aria-describedby=\"footnote-label\" rel=\"noopener noreferrer nofollow ugc\" target=\"_self\">3</a></sup> of this solution is given below:</p>\n<pre><code>class MedianFinder {\n    multiset&lt;int&gt; data;\n    multiset&lt;int&gt;::iterator mid;\n​\npublic:\n    MedianFinder()\n        : mid(data.end())\n    {\n    }\n​\n    void addNum(int num)\n    {\n        const int n = data.size();\n        data.insert(num);\n​\n        if (!n)                                 // first element inserted\n            mid = data.begin();\n        else if (num &lt; *mid)                    // median is decreased\n            mid = (n & 1 ? mid : prev(mid));\n        else                                    // median is increased\n            mid = (n & 1 ? next(mid) : mid);\n    }\n​\n    double findMedian()\n    {\n        const int n = data.size();\n        return ((double) *mid + *next(mid, n % 2 - 1)) * 0.5;\n    }\n};</code></pre>\n<p><strong>Complexity Analysis</strong></p>\n<ul>\n<li>\n<p>Time complexity: <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height: 1em; vertical-align: -0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right: 0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mop\">lo<span style=\"margin-right: 0.01389em;\">g</span></span><span class=\"mspace\" style=\"margin-right: 0.1667em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right: 0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right: 0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height: 1em; vertical-align: -0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right: 0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord\">1</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right: 0.2778em;\"></span><span class=\"mrel\">≈</span><span class=\"mspace\" style=\"margin-right: 0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height: 1em; vertical-align: -0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right: 0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mop\">lo<span style=\"margin-right: 0.01389em;\">g</span></span><span class=\"mspace\" style=\"margin-right: 0.1667em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span></span>.</p>\n<ul>\n<li>Inserting a number takes <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height: 1em; vertical-align: -0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right: 0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mop\">lo<span style=\"margin-right: 0.01389em;\">g</span></span><span class=\"mspace\" style=\"margin-right: 0.1667em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span></span> time for a standard <code>multiset</code> scheme. <sup><a href=\"#user-content-fn-note-4\" id=\"user-content-fnref-note-4\" aria-describedby=\"footnote-label\" rel=\"noopener noreferrer nofollow ugc\" target=\"_self\">4</a></sup></li>\n<li>Finding the mean takes constant <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height: 1em; vertical-align: -0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right: 0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord\">1</span><span class=\"mclose\">)</span></span></span></span></span> time since the median elements are directly accessible from the two pointers.</li>\n</ul>\n</li>\n<li>\n<p>Space complexity: <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height: 1em; vertical-align: -0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right: 0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span></span> linear space to hold input in container.</p>\n</li>\n</ul>\n<hr>\n<h3 id=\"further-thoughts\" level=\"3\" class=\"group/heading relative\"><a href=\"#further-thoughts\" class=\"!text-sd-muted-foreground absolute right-full top-1/2 -translate-y-1/2 cursor-pointer pr-0.5 text-xs opacity-0 group-hover/heading:opacity-100\" aria-hidden=\"true\" tabindex=\"-1\"><div class=\"relative text-[12px] leading-[normal] p-[1px] before:block before:h-3 before:w-3\"><svg aria-hidden=\"true\" focusable=\"false\" data-prefix=\"fas\" data-icon=\"link\" class=\"svg-inline--fa fa-link absolute left-1/2 top-1/2 h-[1em] -translate-x-1/2 -translate-y-1/2 align-[-0.125em]\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 640 512\" spacing=\"square\"><path fill=\"currentColor\" d=\"M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z\"></path></svg></div></a>Further Thoughts</h3>\n<p>There are so many ways around this problem, that frankly, it is scary. Here are a few more that I came across:</p>\n<ul>\n<li>\n<p><strong>Buckets!</strong> If the numbers in the stream are statistically distributed, then it is easier to keep track of buckets where the median would land, than the entire array. Once you know the correct bucket, simply sort it find the median. If the bucket size is significantly smaller than the size of input processed, this results in huge time saving. <a href=\"https://leetcode.com/mitbbs8080/\" target=\"_blank\">@mitbbs8080</a> has an interesting implementation <a href=\"https://leetcode.com/problems/find-median-from-data-stream/discuss/74057/Tired-of-TWO-HEAPSET-solutions-See-this-segment-dividing-solution-(c%2B%2B)\" target=\"_blank\">here.</a></p>\n</li>\n<li>\n<p><strong>Reservoir Sampling.</strong> Following along the lines of using buckets: if the stream is statistically distributed, you can rely on Reservoir Sampling. Basically, if you could maintain just one good bucket (or <em>reservoir</em>) which could hold a representative sample of the entire stream, you could estimate the median of the entire stream from just this one bucket. This means good time and memory performance. Reservoir Sampling lets you do just that. Determining a <strong>\"good\"</strong> size for your reservoir? <em>Now, that's a whole other challenge.</em> A good explanation for this can be found in <a href=\"http://stackoverflow.com/a/10693752/2844164\" target=\"_blank\">this StackOverflow answer.</a></p>\n</li>\n<li>\n<p><strong>Segment Trees</strong> are a great data structure if you need to do a lot of insertions or a lot of read queries over a limited range of input values. They allow us to do all such operations <em>fast</em> and in roughly the <em>same amount of time</em>, <strong>always.</strong> The only problem is that they are far from trivial to implement. Take a look at my <a href=\"https://leetcode.com/articles/a-recursive-approach-to-segment-trees-range-sum-queries-lazy-propagation/\" target=\"_blank\">introductory article on Segment Trees</a> if you are interested.</p>\n</li>\n<li>\n<p><strong>Order Statistic Trees</strong> are data structures which seem to be tailor-made for this problem. They have all the nice features of a BST, but also let you find the <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height: 0.8491em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right: 0.03148em;\">k</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height: 0.8491em;\"><span style=\"top: -3.063em; margin-right: 0.05em;\"><span class=\"pstrut\" style=\"height: 2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">t</span><span class=\"mord mathnormal mtight\">h</span></span></span></span></span></span></span></span></span></span></span></span></span> order element stored in the tree. They are a pain to implement and no standard interview would require you to code these up. But they are fun to use if they are already implemented in the language of your choice. <sup><a href=\"#user-content-fn-note-5\" id=\"user-content-fnref-note-5\" aria-describedby=\"footnote-label\" rel=\"noopener noreferrer nofollow ugc\" target=\"_self\">5</a></sup></p>\n</li>\n</ul>\n<h2 id=\"user-content-footnote-label\" level=\"2\" class=\"group/heading relative\"><a href=\"#user-content-footnote-label\" class=\"!text-sd-muted-foreground absolute right-full top-1/2 -translate-y-1/2 cursor-pointer pr-0.5 text-xs opacity-0 group-hover/heading:opacity-100\" aria-hidden=\"true\" tabindex=\"-1\"><div class=\"relative text-[12px] leading-[normal] p-[1px] before:block before:h-3 before:w-3\"><svg aria-hidden=\"true\" focusable=\"false\" data-prefix=\"fas\" data-icon=\"link\" class=\"svg-inline--fa fa-link absolute left-1/2 top-1/2 h-[1em] -translate-x-1/2 -translate-y-1/2 align-[-0.125em]\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 640 512\" spacing=\"square\"><path fill=\"currentColor\" d=\"M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z\"></path></svg></div></a>Footnotes</h2>\n<ol>\n<li id=\"user-content-fn-note-1\" data-length=\"1\">\n<p>Priority Queues queue out elements based on a predefined priority. They are an abstract concept and can, as such, be implemented in many different ways. Heaps are an efficient way to implement Priority Queues. <a href=\"#user-content-fnref-note-1\" aria-label=\"Back to content\" rel=\"noopener noreferrer nofollow ugc\" target=\"_self\">↩</a></p>\n</li>\n<li id=\"user-content-fn-note-2\" data-length=\"1\">\n<p>Shout-out to <a href=\"https://leetcode.com/pharese/\" target=\"_blank\">@pharese</a> for this approach. <a href=\"#user-content-fnref-note-2\" aria-label=\"Back to content\" rel=\"noopener noreferrer nofollow ugc\" target=\"_self\">↩</a></p>\n</li>\n<li id=\"user-content-fn-note-3\" data-length=\"1\">\n<p>Inspired from <a href=\"https://leetcode.com/problems/sliding-window-median/discuss/96340/on-log-k-c-using-multiset-and-updating-middle-iterator\" target=\"_blank\">this post</a> by <a href=\"https://leetcode.com/stefanpochmann\" target=\"_blank\">@StefanPochmann</a>. <a href=\"#user-content-fnref-note-3\" aria-label=\"Back to content\" rel=\"noopener noreferrer nofollow ugc\" target=\"_self\">↩</a></p>\n</li>\n<li id=\"user-content-fn-note-4\" data-length=\"1\">\n<p><a href=\"http://en.cppreference.com/w/cpp/container/multiset/insert\" target=\"_blank\">Hinting</a> can reduce that to amortized constant <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height: 1em; vertical-align: -0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right: 0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord\">1</span><span class=\"mclose\">)</span></span></span></span></span> time. <a href=\"#user-content-fnref-note-4\" aria-label=\"Back to content\" rel=\"noopener noreferrer nofollow ugc\" target=\"_self\">↩</a></p>\n</li>\n<li id=\"user-content-fn-note-5\" data-length=\"1\">\n<p><a href=\"https://gcc.gnu.org/onlinedocs/libstdc++/manual/policy_based_data_structures_test.html\" target=\"_blank\"><strong>GNU</strong> <code>libstdc++</code></a> users are in luck! Take a look at <a href=\"http://stackoverflow.com/a/11228573/2844164\" target=\"_blank\">this StackOverflow answer.</a> <a href=\"#user-content-fnref-note-5\" aria-label=\"Back to content\" rel=\"noopener noreferrer nofollow ugc\" target=\"_self\">↩</a></p>\n</li>\n</ol>\n</div><span style=\"font-size: 0px; line-height: 0;\">&nbsp;</span></div>",
    "isOfficial": true,
    "scrapedAt": "2026-02-18T07:25:09.717Z"
  }
}