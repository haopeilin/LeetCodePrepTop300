{"id":"262","title":"Trips and Users","difficulty":"Hard","content":"<p>Table: <code>Trips</code></p>\n\n<pre>\n+-------------+----------+\n| Column Name | Type     |\n+-------------+----------+\n| id          | int      |\n| client_id   | int      |\n| driver_id   | int      |\n| city_id     | int      |\n| status      | enum     |\n| request_at  | varchar  |     \n+-------------+----------+\nid is the primary key (column with unique values) for this table.\nThe table holds all taxi trips. Each trip has a unique id, while client_id and driver_id are foreign keys to the users_id at the Users table.\nStatus is an ENUM (category) type of (&#39;completed&#39;, &#39;cancelled_by_driver&#39;, &#39;cancelled_by_client&#39;).\n</pre>\n\n<p> </p>\n\n<p>Table: <code>Users</code></p>\n\n<pre>\n+-------------+----------+\n| Column Name | Type     |\n+-------------+----------+\n| users_id    | int      |\n| banned      | enum     |\n| role        | enum     |\n+-------------+----------+\nusers_id is the primary key (column with unique values) for this table.\nThe table holds all users. Each user has a unique users_id, and role is an ENUM type of (&#39;client&#39;, &#39;driver&#39;, &#39;partner&#39;).\nbanned is an ENUM (category) type of (&#39;Yes&#39;, &#39;No&#39;).\n</pre>\n\n<p> </p>\n\n<p>The <strong>cancellation rate</strong> is computed by dividing the number of canceled (by client or driver) requests with unbanned users by the total number of requests with unbanned users on that day.</p>\n\n<p>Write a solution to find the <strong>cancellation rate</strong> of requests with unbanned users (<strong>both client and driver must not be banned</strong>) each day between <code>&quot;2013-10-01&quot;</code> and <code>&quot;2013-10-03&quot;</code> with <strong>at least</strong> one trip. Round <code>Cancellation Rate</code> to <strong>two decimal</strong> points.</p>\n\n<p>Return the result table in <strong>any order</strong>.</p>\n\n<p>The result format is in the following example.</p>\n\n<p>&nbsp;</p>\n<p><strong class=\"example\">Example 1:</strong></p>\n\n<pre>\n<strong>Input:</strong> \nTrips table:\n+----+-----------+-----------+---------+---------------------+------------+\n| id | client_id | driver_id | city_id | status              | request_at |\n+----+-----------+-----------+---------+---------------------+------------+\n| 1  | 1         | 10        | 1       | completed           | 2013-10-01 |\n| 2  | 2         | 11        | 1       | cancelled_by_driver | 2013-10-01 |\n| 3  | 3         | 12        | 6       | completed           | 2013-10-01 |\n| 4  | 4         | 13        | 6       | cancelled_by_client | 2013-10-01 |\n| 5  | 1         | 10        | 1       | completed           | 2013-10-02 |\n| 6  | 2         | 11        | 6       | completed           | 2013-10-02 |\n| 7  | 3         | 12        | 6       | completed           | 2013-10-02 |\n| 8  | 2         | 12        | 12      | completed           | 2013-10-03 |\n| 9  | 3         | 10        | 12      | completed           | 2013-10-03 |\n| 10 | 4         | 13        | 12      | cancelled_by_driver | 2013-10-03 |\n+----+-----------+-----------+---------+---------------------+------------+\nUsers table:\n+----------+--------+--------+\n| users_id | banned | role   |\n+----------+--------+--------+\n| 1        | No     | client |\n| 2        | Yes    | client |\n| 3        | No     | client |\n| 4        | No     | client |\n| 10       | No     | driver |\n| 11       | No     | driver |\n| 12       | No     | driver |\n| 13       | No     | driver |\n+----------+--------+--------+\n<strong>Output:</strong> \n+------------+-------------------+\n| Day        | Cancellation Rate |\n+------------+-------------------+\n| 2013-10-01 | 0.33              |\n| 2013-10-02 | 0.00              |\n| 2013-10-03 | 0.50              |\n+------------+-------------------+\n<strong>Explanation:</strong> \nOn 2013-10-01:\n  - There were 4 requests in total, 2 of which were canceled.\n  - However, the request with Id=2 was made by a banned client (User_Id=2), so it is ignored in the calculation.\n  - Hence there are 3 unbanned requests in total, 1 of which was canceled.\n  - The Cancellation Rate is (1 / 3) = 0.33\nOn 2013-10-02:\n  - There were 3 requests in total, 0 of which were canceled.\n  - The request with Id=6 was made by a banned client, so it is ignored.\n  - Hence there are 2 unbanned requests in total, 0 of which were canceled.\n  - The Cancellation Rate is (0 / 2) = 0.00\nOn 2013-10-03:\n  - There were 3 requests in total, 1 of which was canceled.\n  - The request with Id=8 was made by a banned client, so it is ignored.\n  - Hence there are 2 unbanned request in total, 1 of which were canceled.\n  - The Cancellation Rate is (1 / 2) = 0.50\n</pre>\n","tags":["Database"],"java_snippet":"","solution":"<div class=\"flex flex-col w-full\" style=\"position: relative;\"><div class=\"mYe_l WRmCx\"><h1 class=\"group/heading relative\" id=\"solution\" level=\"1\"><a aria-hidden=\"true\" class=\"!text-sd-muted-foreground absolute right-full top-1/2 -translate-y-1/2 cursor-pointer pr-0.5 text-xs opacity-0 group-hover/heading:opacity-100\" href=\"#solution\" tabindex=\"-1\"><div class=\"relative text-[12px] leading-[normal] p-[1px] before:block before:h-3 before:w-3\"><svg aria-hidden=\"true\" class=\"svg-inline--fa fa-link absolute left-1/2 top-1/2 h-[1em] -translate-x-1/2 -translate-y-1/2 align-[-0.125em]\" data-icon=\"link\" data-prefix=\"fas\" focusable=\"false\" role=\"img\" spacing=\"square\" viewbox=\"0 0 640 512\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z\" fill=\"currentColor\"></path></svg></div></a>Solution</h1>\n<hr/>\n<h3 class=\"group/heading relative\" id=\"overview\" level=\"3\"><a aria-hidden=\"true\" class=\"!text-sd-muted-foreground absolute right-full top-1/2 -translate-y-1/2 cursor-pointer pr-0.5 text-xs opacity-0 group-hover/heading:opacity-100\" href=\"#overview\" tabindex=\"-1\"><div class=\"relative text-[12px] leading-[normal] p-[1px] before:block before:h-3 before:w-3\"><svg aria-hidden=\"true\" class=\"svg-inline--fa fa-link absolute left-1/2 top-1/2 h-[1em] -translate-x-1/2 -translate-y-1/2 align-[-0.125em]\" data-icon=\"link\" data-prefix=\"fas\" focusable=\"false\" role=\"img\" spacing=\"square\" viewbox=\"0 0 640 512\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z\" fill=\"currentColor\"></path></svg></div></a>Overview</h3>\n<p>Calculate the daily cancellation rate for taxi trip requests made by unbanned users between \"2013-10-01\" and \"2013-10-03\". The cancellation rate for a day is the number of canceled trips (either by client or driver) divided by the total number of trips requested by unbanned users.</p>\n<p><strong>Visualized Output</strong></p>\n<p></p>\n<p><strong>Tables and Fields</strong></p>\n<ol>\n<li data-length=\"1\"><strong>Trips</strong>: The table holds all taxi trips.\n<ul>\n<li>Fields: <code>id</code>, <code>client_id</code>, <code>driver_id</code>, <code>status</code>, <code>request_at</code></li>\n<li>We are interested in the <code>client_id</code>, <code>driver_id</code>, <code>status</code>, and <code>request_at</code> columns.</li>\n</ul>\n</li>\n<li data-length=\"1\"><strong>Users</strong>: The table holds all users.\n<ul>\n<li>Fields: id, client_id, driver_id, status, request_at</li>\n<li>The <code>users_id</code> and <code>banned</code> columns are essential to filter out banned users.</li>\n</ul>\n</li>\n</ol>\n<p><strong>Relationships</strong></p>\n<ol>\n<li data-length=\"1\"><code>Trips.client_id</code> = <code>Users.users_id</code></li>\n<li data-length=\"1\"><code>Trips.driver_id</code> = <code>Users.users_id</code></li>\n</ol>\n<hr/>\n<h2 class=\"group/heading relative\" id=\"pandas\" level=\"2\"><a aria-hidden=\"true\" class=\"!text-sd-muted-foreground absolute right-full top-1/2 -translate-y-1/2 cursor-pointer pr-0.5 text-xs opacity-0 group-hover/heading:opacity-100\" href=\"#pandas\" tabindex=\"-1\"><div class=\"relative text-[12px] leading-[normal] p-[1px] before:block before:h-3 before:w-3\"><svg aria-hidden=\"true\" class=\"svg-inline--fa fa-link absolute left-1/2 top-1/2 h-[1em] -translate-x-1/2 -translate-y-1/2 align-[-0.125em]\" data-icon=\"link\" data-prefix=\"fas\" focusable=\"false\" role=\"img\" spacing=\"square\" viewbox=\"0 0 640 512\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z\" fill=\"currentColor\"></path></svg></div></a>pandas</h2>\n<h3 class=\"group/heading relative\" id=\"approach-1-dataframe-merging\" level=\"3\"><a aria-hidden=\"true\" class=\"!text-sd-muted-foreground absolute right-full top-1/2 -translate-y-1/2 cursor-pointer pr-0.5 text-xs opacity-0 group-hover/heading:opacity-100\" href=\"#approach-1-dataframe-merging\" tabindex=\"-1\"><div class=\"relative text-[12px] leading-[normal] p-[1px] before:block before:h-3 before:w-3\"><svg aria-hidden=\"true\" class=\"svg-inline--fa fa-link absolute left-1/2 top-1/2 h-[1em] -translate-x-1/2 -translate-y-1/2 align-[-0.125em]\" data-icon=\"link\" data-prefix=\"fas\" focusable=\"false\" role=\"img\" spacing=\"square\" viewbox=\"0 0 640 512\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z\" fill=\"currentColor\"></path></svg></div></a>Approach 1: DataFrame Merging</h3>\n<h4 id=\"intuition\">Intuition</h4>\n<p>The algorithm merges trip information with user details, filters out trips with banned users and those outside a specific date range, and then calculates the daily cancellation rate for the selected trips.</p>\n<h4 id=\"algorithm\">Algorithm</h4>\n<ol>\n<li data-length=\"1\">\n<p><strong>Preliminary Check</strong>:</p>\n<ul>\n<li>Check if either the <code>trips</code> or <code>users</code> DataFrame is empty.</li>\n<li>If either is empty, return a DataFrame with \"Day\" and \"Cancellation Rate\" columns.</li>\n</ul>\n</li>\n<li data-length=\"1\">\n<p><strong>Prepare Data for Client Merge</strong>:</p>\n<ul>\n<li>Adjust the <code>users</code> DataFrame column names for clarity:\n<ul>\n<li>Rename <code>users_id</code> to <code>client_id</code>.</li>\n<li>Rename <code>banned</code> to <code>client_banned</code>.</li>\n</ul>\n</li>\n</ul>\n</li>\n</ol>\n<table><tbody><tr><th>client_id</th><th>client_banned</th><th>role</th></tr><tr><td>1</td><td>No</td><td>client</td></tr><tr><td>2</td><td>Yes</td><td>client</td></tr><tr><td>3</td><td>No</td><td>client</td></tr><tr><td>4</td><td>No</td><td>client</td></tr></tbody></table>\n<br/>\n<ol start=\"3\">\n<li data-length=\"1\"><strong>Client Merge</strong>:\n<ul>\n<li>Merge <code>trips</code> with the modified <code>users</code> DataFrame using <code>client_id</code>.</li>\n<li>Use a left merge to ensure retention of all trip records.</li>\n<li>The outcome is the <code>trips_with_clients</code> DataFrame.</li>\n</ul>\n</li>\n</ol>\n<table><tbody><tr><th>id</th><th>client_id</th><th>driver_id</th><th>city_id</th><th>status</th><th>request_at</th><th>client_banned</th><th>role</th></tr><tr><td>1</td><td>1</td><td>10</td><td>1</td><td>completed</td><td>2013-10-01</td><td>No</td><td>client</td></tr><tr><td>2</td><td>2</td><td>11</td><td>1</td><td>cancelled_by_driver</td><td>2013-10-01</td><td>Yes</td><td>client</td></tr></tbody></table>\n<br/>\n<ol start=\"4\">\n<li data-length=\"1\"><strong>Prepare Data for Driver Merge</strong>:\n<ul>\n<li>Modify column names in the <code>users</code> DataFrame to differentiate drivers:\n<ul>\n<li>Change <code>users_id</code> to <code>driver_id</code>.</li>\n<li>Adjust <code>banned</code> to <code>driver_banned</code>.</li>\n</ul>\n</li>\n</ul>\n</li>\n</ol>\n<table><tbody><tr><th>driver_id</th><th>driver_banned</th><th>role</th></tr><tr><td>10</td><td>No</td><td>driver</td></tr><tr><td>11</td><td>No</td><td>driver</td></tr><tr><td>12</td><td>No</td><td>driver</td></tr><tr><td>13</td><td>No</td><td>driver</td></tr></tbody></table>\n<br/>\n<ol start=\"5\">\n<li data-length=\"1\"><strong>Driver Merge</strong>:\n<ul>\n<li>Combine <code>trips_with_clients</code> with the modified <code>users</code> DataFrame based on <code>driver_id</code>.</li>\n<li>Utilize a left merge once more.</li>\n<li>The final merged data is stored as <code>full_trips</code>.</li>\n</ul>\n</li>\n</ol>\n<table><tbody><tr><th>id</th><th>client_id</th><th>driver_id</th><th>city_id</th><th>status</th><th>request_at</th><th>client_banned</th><th>client_role</th><th>driver_banned</th><th>driver_role</th></tr><tr><td>1</td><td>1</td><td>10</td><td>1</td><td>completed</td><td>2013-10-01</td><td>No</td><td>client</td><td>No</td><td>driver</td></tr><tr><td>2</td><td>2</td><td>11</td><td>1</td><td>cancelled_by_driver</td><td>2013-10-01</td><td>Yes</td><td>client</td><td>No</td><td>driver</td></tr></tbody></table>\n<br/>\n<ol start=\"6\">\n<li data-length=\"1\"><strong>Filtering</strong>:\n<ul>\n<li>Apply boolean indexing to <code>full_trips</code> to:\n<ul>\n<li>Omit entries with banned clients or drivers.</li>\n<li>Retain rows where the <code>request_at</code> date falls between '2013-10-01' and '2013-10-03'.</li>\n</ul>\n</li>\n<li>The filtered data is saved as <code>filtered_trips</code>.</li>\n</ul>\n</li>\n</ol>\n<table><tbody><tr><th>id</th><th>client_id</th><th>driver_id</th><th>city_id</th><th>status</th><th>request_at</th><th>client_banned</th><th>client_role</th><th>driver_banned</th><th>driver_role</th></tr><tr><td>1</td><td>1</td><td>10</td><td>1</td><td>completed</td><td>2013-10-01</td><td>No</td><td>client</td><td>No</td><td>driver</td></tr></tbody></table>\n<br/>\n<ol start=\"7\">\n<li data-length=\"1\"><strong>Calculate Cancellation Rate</strong>:\n<ul>\n<li>Group <code>filtered_trips</code> by the <code>request_at</code> column.</li>\n<li>Within each group, determine the cancellation rate, which is the proportion of trips not marked as 'completed'.</li>\n<li>Round the result to two decimal places.</li>\n</ul>\n</li>\n</ol>\n<table><tbody><tr><th>request_at</th><th>Cancellation Rate</th></tr><tr><td>2013-10-01</td><td>0.33</td></tr><tr><td>2013-10-02</td><td>0.00</td></tr><tr><td>2013-10-03</td><td>0.50</td></tr></tbody></table>\n<br/>\n<ol start=\"8\">\n<li data-length=\"1\"><strong>Result Presentation</strong>:\n<ul>\n<li>If the computed result is empty after determining the cancellation rate, output an empty DataFrame with \"Day\" and \"Cancellation Rate\" columns.</li>\n<li>Otherwise, reset the index of the result and rename the <code>request_at</code> column as \"Day\".</li>\n</ul>\n</li>\n</ol>\n<table><tbody><tr><th>Day</th><th>Cancellation Rate</th></tr><tr><td>2013-10-01</td><td>0.33</td></tr><tr><td>2013-10-02</td><td>0.00</td></tr><tr><td>2013-10-03</td><td>0.50</td></tr></tbody></table>\n<br/>\n<h4 id=\"implementation\">Implementation</h4>\n<p>Based on the understanding above, the solution can be implemented as:</p>\n<pre><code>import pandas as pd\n​\ndef trips_and_users(trips: pd.DataFrame, users: pd.DataFrame) -&gt; pd.DataFrame:\n​\n    # Step 1: Preliminary Check\n    if trips.empty or users.empty:\n        return pd.DataFrame(columns=[\"Day\", \"Cancellation Rate\"])\n​\n    # Step 2: Prepare Data for Client Merge\n    renamed_users_for_clients = users.rename(\n        columns={\"users_id\": \"client_id\", \"banned\": \"client_banned\"}\n    )\n​\n    # Step 3: Client Merge\n    trips_with_clients = trips.merge(\n        renamed_users_for_clients, on=\"client_id\", how=\"left\"\n    )\n​\n    # Step 4: Prepare Data for Driver Merge\n    renamed_users_for_drivers = users.rename(\n        columns={\"users_id\": \"driver_id\", \"banned\": \"driver_banned\"}\n    )\n​\n    # Step 5: Driver Merge\n    full_trips = trips_with_clients.merge(\n        renamed_users_for_drivers, on=\"driver_id\", how=\"left\"\n    )\n​\n    # Step 6: Filtering\n    filtered_trips = full_trips[\n        (full_trips[\"client_banned\"] == \"No\")\n        &amp; (full_trips[\"driver_banned\"] == \"No\")\n        &amp; (full_trips[\"request_at\"].between(\"2013-10-01\", \"2013-10-03\"))\n    ]\n​\n    # Step 7: Calculate Cancellation Rate\n    result = filtered_trips.groupby(\"request_at\").apply(\n        lambda group: pd.Series(\n            {\n                \"Cancellation Rate\": round(\n                    (group[\"status\"] != \"completed\").sum() / len(group), 2\n                )\n            }\n        )\n    )\n​\n    # Step 8: Result Presentation\n    if result.empty:\n        return pd.DataFrame(columns=[\"Day\", \"Cancellation Rate\"])\n    else:\n        return result.reset_index().rename(columns={\"request_at\": \"Day\"})</code></pre>\n<h3 class=\"group/heading relative\" id=\"approach-2-utilizing-intermediate-dataframes\" level=\"3\"><a aria-hidden=\"true\" class=\"!text-sd-muted-foreground absolute right-full top-1/2 -translate-y-1/2 cursor-pointer pr-0.5 text-xs opacity-0 group-hover/heading:opacity-100\" href=\"#approach-2-utilizing-intermediate-dataframes\" tabindex=\"-1\"><div class=\"relative text-[12px] leading-[normal] p-[1px] before:block before:h-3 before:w-3\"><svg aria-hidden=\"true\" class=\"svg-inline--fa fa-link absolute left-1/2 top-1/2 h-[1em] -translate-x-1/2 -translate-y-1/2 align-[-0.125em]\" data-icon=\"link\" data-prefix=\"fas\" focusable=\"false\" role=\"img\" spacing=\"square\" viewbox=\"0 0 640 512\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z\" fill=\"currentColor\"></path></svg></div></a>Approach 2: Utilizing Intermediate DataFrames</h3>\n<h4 id=\"intuition-1\">Intuition</h4>\n<p>The key idea here is to pinpoint the undesirable rows (or indices) and then discard them.</p>\n<p>Use boolean indexing to spot rows in the <code>users</code> DataFrame representing banned users. Subsequently, with the <code>isin</code> method, eliminate rows in the <code>trips</code> DataFrame associated with these users. Essentially, this method is about tagging certain rows or indices as \"unwanted\" and then bypassing them in the main operation.</p>\n<h4 id=\"algorithm-1\">Algorithm</h4>\n<ol>\n<li data-length=\"1\">\n<p><strong>Data Verification:</strong></p>\n<ul>\n<li>Check if either <code>trips</code> or <code>users</code> DataFrames are empty.</li>\n<li>If so, return a DataFrame with columns \"Day\" and \"Cancellation Rate\" without any data.</li>\n</ul>\n</li>\n<li data-length=\"1\">\n<p><strong>Isolating Banned Users:</strong></p>\n<ul>\n<li>Use boolean indexing on the <code>users</code> DataFrame to extract the IDs (<code>users_id</code>) of users who are banned.</li>\n</ul>\n</li>\n<li data-length=\"1\">\n<p><strong>Filtering Relevant Trip Data:</strong></p>\n<ul>\n<li>Discard rows from the <code>trips</code> DataFrame with <code>client_id</code> or <code>driver_id</code> matching the IDs of banned users.</li>\n<li>Retain rows in the <code>trips</code> DataFrame with <code>request_at</code> dates from '2013-10-01' to '2013-10-03'.</li>\n</ul>\n</li>\n<li data-length=\"1\">\n<p><strong>Aggregating Data:</strong></p>\n<ul>\n<li>Group data in the <code>selected_trips</code> DataFrame by the <code>request_at</code> column.</li>\n<li>For each group, compute the cancellation rate by finding the ratio of non-completed trips to the total trips, rounded to two decimal places.</li>\n</ul>\n</li>\n<li data-length=\"1\">\n<p><strong>Result Compilation:</strong></p>\n<ul>\n<li>If <code>aggregated_result</code> DataFrame isn't empty, reset its index and rename the <code>request_at</code> column to 'Date'.</li>\n<li>If it's empty, return a DataFrame with columns \"Date\" and \"Cancellation Rate\" without any data.</li>\n</ul>\n</li>\n</ol>\n<h4 id=\"implementation-1\">Implementation</h4>\n<p>Based on the understanding above, the solution can be implemented as:</p>\n<div class=\"font-menlo mb-6 rounded-lg px-3 py-2.5 text-sm bg-fill-3 dark:bg-dark-fill-3\"><div class=\"group relative\" translate=\"no\"><pre style=\"color: black; font-size: 13px; text-shadow: none; font-family: Menlo, Monaco, Consolas; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 4; hyphens: none; padding: 0px; margin: 0px; overflow: auto; background: transparent; overflow-wrap: normal;\"><code class=\"language-python\" style=\"white-space: pre; text-shadow: none;\"><span><span class=\"token\" style=\"color: rgb(0, 119, 170);\">import</span><span> pandas </span><span class=\"token\" style=\"color: rgb(0, 119, 170);\">as</span><span> pd\n</span></span><span>\n</span><span><span></span><span class=\"token\" style=\"color: rgb(0, 119, 170);\">def</span><span> </span><span class=\"token\" style=\"color: rgb(221, 74, 104);\">trips_and_users</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">(</span><span>trips</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">:</span><span> pd</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">.</span><span>DataFrame</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">,</span><span> users</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">:</span><span> pd</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">.</span><span>DataFrame</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">)</span><span> </span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">-</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">&gt;</span><span> pd</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">.</span><span>DataFrame</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">:</span><span>\n</span></span><span><span>    </span><span class=\"token\" style=\"color: slategray;\"># Step 1: Data Verification</span><span>\n</span></span><span><span>    </span><span class=\"token\" style=\"color: slategray;\"># Check if either `trips` or `users` DataFrames are empty.</span><span>\n</span></span><span><span>    </span><span class=\"token\" style=\"color: slategray;\"># If so, return a DataFrame with columns \"Day\" and \"Cancellation Rate\" without any data.</span><span>\n</span></span><span><span>    </span><span class=\"token\" style=\"color: rgb(0, 119, 170);\">if</span><span> trips</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">.</span><span>empty </span><span class=\"token\" style=\"color: rgb(0, 119, 170);\">or</span><span> users</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">.</span><span>empty</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">:</span><span>\n</span></span><span><span>        </span><span class=\"token\" style=\"color: rgb(0, 119, 170);\">return</span><span> pd</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">.</span><span>DataFrame</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">(</span><span>columns</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">=</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">[</span><span class=\"token\" style=\"color: rgb(102, 153, 0);\">\"Day\"</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">,</span><span> </span><span class=\"token\" style=\"color: rgb(102, 153, 0);\">\"Cancellation Rate\"</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">]</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">)</span><span>\n</span></span><span>\n</span><span><span>    </span><span class=\"token\" style=\"color: slategray;\"># Step 2: Isolating Banned Users</span><span>\n</span></span><span><span>    </span><span class=\"token\" style=\"color: slategray;\"># Using boolean indexing on the `users` DataFrame, extract the IDs (`users_id`) of users who are banned.</span><span>\n</span></span><span><span>    banned_users_ids </span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">=</span><span> users</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">[</span><span>users</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">[</span><span class=\"token\" style=\"color: rgb(102, 153, 0);\">\"banned\"</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">]</span><span> </span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">==</span><span> </span><span class=\"token\" style=\"color: rgb(102, 153, 0);\">\"Yes\"</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">]</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">[</span><span class=\"token\" style=\"color: rgb(102, 153, 0);\">\"users_id\"</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">]</span><span>\n</span></span><span>\n</span><span><span>    </span><span class=\"token\" style=\"color: slategray;\"># Step 3: Filtering Relevant Trip Data</span><span>\n</span></span><span><span>    </span><span class=\"token\" style=\"color: slategray;\"># Remove rows from `trips` DataFrame that have `client_id` or `driver_id` matching the IDs of banned users.</span><span>\n</span></span><span><span>    </span><span class=\"token\" style=\"color: slategray;\"># Retain rows in the `trips` DataFrame that have `request_at` dates within the range of '2013-10-01' to '2013-10-03'.</span><span>\n</span></span><span><span>    selected_trips </span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">=</span><span> trips</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">[</span><span>\n</span></span><span><span>        </span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">(</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">~</span><span>trips</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">[</span><span class=\"token\" style=\"color: rgb(102, 153, 0);\">\"client_id\"</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">]</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">.</span><span>isin</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">(</span><span>banned_users_ids</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">)</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">)</span><span>\n</span></span><span><span>        </span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">&amp;</span><span> </span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">(</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">~</span><span>trips</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">[</span><span class=\"token\" style=\"color: rgb(102, 153, 0);\">\"driver_id\"</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">]</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">.</span><span>isin</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">(</span><span>banned_users_ids</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">)</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">)</span><span>\n</span></span><span><span>        </span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">&amp;</span><span> </span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">(</span><span>trips</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">[</span><span class=\"token\" style=\"color: rgb(102, 153, 0);\">\"request_at\"</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">]</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">.</span><span>between</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">(</span><span class=\"token\" style=\"color: rgb(102, 153, 0);\">\"2013-10-01\"</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">,</span><span> </span><span class=\"token\" style=\"color: rgb(102, 153, 0);\">\"2013-10-03\"</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">)</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">)</span><span>\n</span></span><span><span>    </span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">]</span><span>\n</span></span><span>\n</span><span><span>    </span><span class=\"token\" style=\"color: slategray;\"># Step 4: Aggregating Data</span><span>\n</span></span><span><span>    </span><span class=\"token\" style=\"color: slategray;\"># Group the data in the `selected_trips` DataFrame based on the `request_at` column.</span><span>\n</span></span><span><span>    </span><span class=\"token\" style=\"color: slategray;\"># For each group, calculate the cancellation rate by determining the ratio of non-completed trips to the total number of trips, rounding to two decimal places.</span><span>\n</span></span><span><span>    aggregated_result </span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">=</span><span> selected_trips</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">.</span><span>groupby</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">(</span><span class=\"token\" style=\"color: rgb(102, 153, 0);\">\"request_at\"</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">)</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">.</span><span class=\"token\" style=\"color: rgb(102, 153, 0);\">apply</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">(</span><span>\n</span></span><span><span>        </span><span class=\"token\" style=\"color: rgb(0, 119, 170);\">lambda</span><span> group</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">:</span><span> pd</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">.</span><span>Series</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">(</span><span>\n</span></span><span><span>            </span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">{</span><span>\n</span></span><span><span>                </span><span class=\"token\" style=\"color: rgb(102, 153, 0);\">\"Cancellation Rate\"</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">:</span><span> </span><span class=\"token\" style=\"color: rgb(102, 153, 0);\">round</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">(</span><span>\n</span></span><span><span>                    </span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">(</span><span>group</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">[</span><span class=\"token\" style=\"color: rgb(102, 153, 0);\">\"status\"</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">]</span><span> </span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">!=</span><span> </span><span class=\"token\" style=\"color: rgb(102, 153, 0);\">\"completed\"</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">)</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">.</span><span class=\"token\" style=\"color: rgb(102, 153, 0);\">sum</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">(</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">)</span><span> </span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">/</span><span> </span><span class=\"token\" style=\"color: rgb(102, 153, 0);\">len</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">(</span><span>group</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">)</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">,</span><span> </span><span class=\"token\" style=\"color: rgb(153, 0, 85);\">2</span><span>\n</span></span><span><span>                </span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">)</span><span>\n</span></span><span><span>            </span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">}</span><span>\n</span></span><span><span>        </span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">)</span><span>\n</span></span><span><span>    </span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">)</span><span>\n</span></span><span>\n</span><span><span>    </span><span class=\"token\" style=\"color: slategray;\"># Step 5: Result Compilation</span><span>\n</span></span><span><span>    </span><span class=\"token\" style=\"color: slategray;\"># If the `aggregated_result` DataFrame isn't empty, reset its index and rename the `request_at` column to 'Date'.</span><span>\n</span></span><span><span>    </span><span class=\"token\" style=\"color: slategray;\"># If it's empty, return a DataFrame with columns \"Date\" and \"Cancellation Rate\" without any data.</span><span>\n</span></span><span><span>    </span><span class=\"token\" style=\"color: rgb(0, 119, 170);\">if</span><span> aggregated_result</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">.</span><span>empty</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">:</span><span>\n</span></span><span><span>        </span><span class=\"token\" style=\"color: rgb(0, 119, 170);\">return</span><span> pd</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">.</span><span>DataFrame</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">(</span><span>columns</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">=</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">[</span><span class=\"token\" style=\"color: rgb(102, 153, 0);\">\"Day\"</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">,</span><span> </span><span class=\"token\" style=\"color: rgb(102, 153, 0);\">\"Cancellation Rate\"</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">]</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">)</span><span>\n</span></span><span><span>    </span><span class=\"token\" style=\"color: rgb(0, 119, 170);\">else</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">:</span><span>\n</span></span><span><span>        </span><span class=\"token\" style=\"color: rgb(0, 119, 170);\">return</span><span> aggregated_result</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">.</span><span>reset_index</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">(</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">)</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">.</span><span>rename</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">(</span><span>columns</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">=</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">{</span><span class=\"token\" style=\"color: rgb(102, 153, 0);\">\"request_at\"</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">:</span><span> </span><span class=\"token\" style=\"color: rgb(102, 153, 0);\">\"Day\"</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">}</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">)</span><span>\n</span></span><span></span></code></pre><div class=\"absolute -right-1.5 -top-0.5 flex gap-2\"><div class=\"z-base-1 hidden rounded border group-hover:block border-border-quaternary dark:border-border-quaternary bg-layer-02 dark:bg-layer-02\"><div class=\"relative cursor-pointer flex h-[22px] w-[22px] items-center justify-center bg-layer-02 dark:bg-layer-02 hover:bg-fill-tertiary dark:hover:bg-fill-tertiary rounded-[4px]\" data-state=\"closed\"><div><div data-state=\"closed\"><div class=\"relative text-[12px] leading-[normal] p-[1px] before:block before:h-3 before:w-3 h-3.5 w-3.5 text-text-primary dark:text-text-primary\"><svg aria-hidden=\"true\" class=\"svg-inline--fa fa-clone absolute left-1/2 top-1/2 h-[1em] -translate-x-1/2 -translate-y-1/2 align-[-0.125em]\" data-icon=\"clone\" data-prefix=\"far\" focusable=\"false\" role=\"img\" viewbox=\"0 0 512 512\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M64 464H288c8.8 0 16-7.2 16-16V384h48v64c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V224c0-35.3 28.7-64 64-64h64v48H64c-8.8 0-16 7.2-16 16V448c0 8.8 7.2 16 16 16zM224 304H448c8.8 0 16-7.2 16-16V64c0-8.8-7.2-16-16-16H224c-8.8 0-16 7.2-16 16V288c0 8.8 7.2 16 16 16zm-64-16V64c0-35.3 28.7-64 64-64H448c35.3 0 64 28.7 64 64V288c0 35.3-28.7 64-64 64H224c-35.3 0-64-28.7-64-64z\" fill=\"currentColor\"></path></svg></div></div></div></div></div></div></div></div>\n<h3 class=\"group/heading relative\" id=\"approach-3-dataframe-transformations-common-table-expression-equivalent\" level=\"3\"><a aria-hidden=\"true\" class=\"!text-sd-muted-foreground absolute right-full top-1/2 -translate-y-1/2 cursor-pointer pr-0.5 text-xs opacity-0 group-hover/heading:opacity-100\" href=\"#approach-3-dataframe-transformations-common-table-expression-equivalent\" tabindex=\"-1\"><div class=\"relative text-[12px] leading-[normal] p-[1px] before:block before:h-3 before:w-3\"><svg aria-hidden=\"true\" class=\"svg-inline--fa fa-link absolute left-1/2 top-1/2 h-[1em] -translate-x-1/2 -translate-y-1/2 align-[-0.125em]\" data-icon=\"link\" data-prefix=\"fas\" focusable=\"false\" role=\"img\" spacing=\"square\" viewbox=\"0 0 640 512\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z\" fill=\"currentColor\"></path></svg></div></a>Approach 3: DataFrame Transformations (Common Table Expression Equivalent)</h3>\n<h4 id=\"intuition-2\">Intuition</h4>\n<p>The idea is to filter out trips outside of the three-day window and those involving banned users. The cancellation status of trips is simplified into binary values for easy computation. Data is grouped by day to provide granular insights, and the results are structured for clarity, offering a straightforward representation of daily cancellation rates.</p>\n<h4 id=\"algorithm-2\">Algorithm</h4>\n<ol>\n<li data-length=\"1\">\n<p><strong>Initial Check:</strong></p>\n<ul>\n<li>If either the <code>trips</code> or <code>users</code> DataFrames are empty, return an empty DataFrame with columns \"Day\" and \"Cancellation Rate\".</li>\n</ul>\n</li>\n<li data-length=\"1\">\n<p><strong>Date-based Filtering:</strong></p>\n<ul>\n<li>Filter the <code>trips</code> DataFrame to only include records between October 1st and October 3rd, 2013.</li>\n</ul>\n</li>\n<li data-length=\"1\">\n<p><strong>Merge with Non-Banned Clients:</strong></p>\n<ul>\n<li>Merge the filtered <code>trips</code> DataFrame with the <code>users</code> DataFrame, specifically targeting non-banned users (<code>banned</code> column value is 'No').</li>\n<li>This merge operation is based on the <code>client_id</code> from <code>trips</code> and <code>users_id</code> from <code>users</code>.</li>\n<li>This ensures that trips with banned clients are excluded.</li>\n</ul>\n</li>\n<li data-length=\"1\">\n<p><strong>Merge with Non-Banned Drivers:</strong></p>\n<ul>\n<li>Merge the resultant DataFrame from step 3 with the <code>users</code> DataFrame again, focusing on non-banned users.</li>\n<li>This time, the merge operation is based on the <code>driver_id</code> from the trips and <code>users_id</code> from <code>users</code>.</li>\n<li>This ensures that trips with banned drivers are excluded.</li>\n</ul>\n</li>\n<li data-length=\"1\">\n<p><strong>Calculate Day-wise Cancellation Rate:</strong></p>\n<ul>\n<li>Group the DataFrame by the <code>request_at</code> column, which represents the day of the trip.</li>\n<li>For each group, compute the cancellation rate by finding the ratio of non-completed trips to the total trips, rounded to two decimal places.</li>\n</ul>\n</li>\n<li data-length=\"1\">\n<p><strong>Format and Return the Result:</strong></p>\n<ul>\n<li>Reset the index of the resultant DataFrame for proper sequencing.</li>\n<li>Rename the <code>request_at</code> column to 'Day'.</li>\n<li>If the resulting DataFrame is empty, return an empty DataFrame with columns \"Day\" and \"Cancellation Rate\". Otherwise, return the computed results.</li>\n</ul>\n</li>\n</ol>\n<h4 id=\"implementation-2\">Implementation</h4>\n<p>Based on the understanding above, the solution can be implemented as:</p>\n<div class=\"font-menlo mb-6 rounded-lg px-3 py-2.5 text-sm bg-fill-3 dark:bg-dark-fill-3\"><div class=\"group relative\" translate=\"no\"><pre style=\"color: black; font-size: 13px; text-shadow: none; font-family: Menlo, Monaco, Consolas; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 4; hyphens: none; padding: 0px; margin: 0px; overflow: auto; background: transparent; overflow-wrap: normal;\"><code class=\"language-python\" style=\"white-space: pre; text-shadow: none;\"><span><span class=\"token\" style=\"color: rgb(0, 119, 170);\">import</span><span> pandas </span><span class=\"token\" style=\"color: rgb(0, 119, 170);\">as</span><span> pd\n</span></span><span>\n</span><span><span></span><span class=\"token\" style=\"color: rgb(0, 119, 170);\">def</span><span> </span><span class=\"token\" style=\"color: rgb(221, 74, 104);\">trips_and_users</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">(</span><span>trips</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">:</span><span> pd</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">.</span><span>DataFrame</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">,</span><span> users</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">:</span><span> pd</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">.</span><span>DataFrame</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">)</span><span> </span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">-</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">&gt;</span><span> pd</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">.</span><span>DataFrame</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">:</span><span>\n</span></span><span><span>    </span><span class=\"token\" style=\"color: slategray;\"># Step 1: Initial Check</span><span>\n</span></span><span><span>    </span><span class=\"token\" style=\"color: rgb(0, 119, 170);\">if</span><span> trips</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">.</span><span>empty </span><span class=\"token\" style=\"color: rgb(0, 119, 170);\">or</span><span> users</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">.</span><span>empty</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">:</span><span>\n</span></span><span><span>        </span><span class=\"token\" style=\"color: rgb(0, 119, 170);\">return</span><span> pd</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">.</span><span>DataFrame</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">(</span><span>columns</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">=</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">[</span><span class=\"token\" style=\"color: rgb(102, 153, 0);\">\"Day\"</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">,</span><span> </span><span class=\"token\" style=\"color: rgb(102, 153, 0);\">\"Cancellation Rate\"</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">]</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">)</span><span>\n</span></span><span>\n</span><span><span>    </span><span class=\"token\" style=\"color: slategray;\"># Step 2: Date-based Filtering</span><span>\n</span></span><span><span>    filtered_trips </span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">=</span><span> trips</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">[</span><span>trips</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">[</span><span class=\"token\" style=\"color: rgb(102, 153, 0);\">\"request_at\"</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">]</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">.</span><span>between</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">(</span><span class=\"token\" style=\"color: rgb(102, 153, 0);\">\"2013-10-01\"</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">,</span><span> </span><span class=\"token\" style=\"color: rgb(102, 153, 0);\">\"2013-10-03\"</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">)</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">]</span><span>\n</span></span><span>\n</span><span><span>    </span><span class=\"token\" style=\"color: slategray;\"># Step 3: Merge with Non-Banned Clients</span><span>\n</span></span><span><span>    trips_with_clients </span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">=</span><span> filtered_trips</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">.</span><span>merge</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">(</span><span>\n</span></span><span><span>        users</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">.</span><span>loc</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">[</span><span>users</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">[</span><span class=\"token\" style=\"color: rgb(102, 153, 0);\">\"banned\"</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">]</span><span> </span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">==</span><span> </span><span class=\"token\" style=\"color: rgb(102, 153, 0);\">\"No\"</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">,</span><span> </span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">[</span><span class=\"token\" style=\"color: rgb(102, 153, 0);\">\"users_id\"</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">]</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">]</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">,</span><span>\n</span></span><span><span>        left_on</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">=</span><span class=\"token\" style=\"color: rgb(102, 153, 0);\">\"client_id\"</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">,</span><span>\n</span></span><span><span>        right_on</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">=</span><span class=\"token\" style=\"color: rgb(102, 153, 0);\">\"users_id\"</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">,</span><span>\n</span></span><span><span>        how</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">=</span><span class=\"token\" style=\"color: rgb(102, 153, 0);\">\"inner\"</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">,</span><span>\n</span></span><span><span>    </span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">)</span><span>\n</span></span><span>\n</span><span><span>    </span><span class=\"token\" style=\"color: slategray;\"># Step 4: Merge with Non-Banned Drivers</span><span>\n</span></span><span><span>    trip_status </span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">=</span><span> trips_with_clients</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">.</span><span>merge</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">(</span><span>\n</span></span><span><span>        users</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">.</span><span>loc</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">[</span><span>users</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">[</span><span class=\"token\" style=\"color: rgb(102, 153, 0);\">\"banned\"</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">]</span><span> </span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">==</span><span> </span><span class=\"token\" style=\"color: rgb(102, 153, 0);\">\"No\"</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">,</span><span> </span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">[</span><span class=\"token\" style=\"color: rgb(102, 153, 0);\">\"users_id\"</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">]</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">]</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">,</span><span>\n</span></span><span><span>        left_on</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">=</span><span class=\"token\" style=\"color: rgb(102, 153, 0);\">\"driver_id\"</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">,</span><span>\n</span></span><span><span>        right_on</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">=</span><span class=\"token\" style=\"color: rgb(102, 153, 0);\">\"users_id\"</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">,</span><span>\n</span></span><span><span>        how</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">=</span><span class=\"token\" style=\"color: rgb(102, 153, 0);\">\"inner\"</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">,</span><span>\n</span></span><span><span>    </span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">)</span><span>\n</span></span><span>\n</span><span><span>    </span><span class=\"token\" style=\"color: slategray;\"># Step 5: Calculate Day-wise Cancellation Rate</span><span>\n</span></span><span><span>    result </span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">=</span><span> trip_status</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">.</span><span>groupby</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">(</span><span class=\"token\" style=\"color: rgb(102, 153, 0);\">\"request_at\"</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">)</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">.</span><span class=\"token\" style=\"color: rgb(102, 153, 0);\">apply</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">(</span><span>\n</span></span><span><span>        </span><span class=\"token\" style=\"color: rgb(0, 119, 170);\">lambda</span><span> group</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">:</span><span> pd</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">.</span><span>Series</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">(</span><span>\n</span></span><span><span>            </span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">{</span><span class=\"token\" style=\"color: rgb(102, 153, 0);\">\"Cancellation Rate\"</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">:</span><span> </span><span class=\"token\" style=\"color: rgb(102, 153, 0);\">round</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">(</span><span>\n</span></span><span><span>                 </span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">(</span><span>group</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">[</span><span class=\"token\" style=\"color: rgb(102, 153, 0);\">\"status\"</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">]</span><span> </span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">!=</span><span> </span><span class=\"token\" style=\"color: rgb(102, 153, 0);\">\"completed\"</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">)</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">.</span><span class=\"token\" style=\"color: rgb(102, 153, 0);\">sum</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">(</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">)</span><span> </span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">/</span><span> </span><span class=\"token\" style=\"color: rgb(102, 153, 0);\">len</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">(</span><span>group</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">)</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">,</span><span> </span><span class=\"token\" style=\"color: rgb(153, 0, 85);\">2</span><span>\n</span></span><span><span>                 </span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">)</span><span>\n</span></span><span><span>             </span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">}</span><span>\n</span></span><span><span>        </span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">)</span><span>\n</span></span><span><span>    </span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">)</span><span>\n</span></span><span>\n</span><span><span>    </span><span class=\"token\" style=\"color: slategray;\"># Step 6: Format and Return the Result</span><span>\n</span></span><span><span>    </span><span class=\"token\" style=\"color: rgb(0, 119, 170);\">if</span><span> result</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">.</span><span>empty</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">:</span><span>\n</span></span><span><span>        </span><span class=\"token\" style=\"color: rgb(0, 119, 170);\">return</span><span> pd</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">.</span><span>DataFrame</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">(</span><span>columns</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">=</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">[</span><span class=\"token\" style=\"color: rgb(102, 153, 0);\">\"Day\"</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">,</span><span> </span><span class=\"token\" style=\"color: rgb(102, 153, 0);\">\"Cancellation Rate\"</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">]</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">)</span><span>\n</span></span><span><span>    </span><span class=\"token\" style=\"color: rgb(0, 119, 170);\">else</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">:</span><span>\n</span></span><span><span>        </span><span class=\"token\" style=\"color: rgb(0, 119, 170);\">return</span><span> result</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">.</span><span>reset_index</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">(</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">)</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">.</span><span>rename</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">(</span><span>columns</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">=</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">{</span><span class=\"token\" style=\"color: rgb(102, 153, 0);\">\"request_at\"</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">:</span><span> </span><span class=\"token\" style=\"color: rgb(102, 153, 0);\">\"Day\"</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">}</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">)</span><span>\n</span></span><span>\n</span><span></span></code></pre><div class=\"absolute -right-1.5 -top-0.5 flex gap-2\"><div class=\"z-base-1 hidden rounded border group-hover:block border-border-quaternary dark:border-border-quaternary bg-layer-02 dark:bg-layer-02\"><div class=\"relative cursor-pointer flex h-[22px] w-[22px] items-center justify-center bg-layer-02 dark:bg-layer-02 hover:bg-fill-tertiary dark:hover:bg-fill-tertiary rounded-[4px]\" data-state=\"closed\"><div><div data-state=\"closed\"><div class=\"relative text-[12px] leading-[normal] p-[1px] before:block before:h-3 before:w-3 h-3.5 w-3.5 text-text-primary dark:text-text-primary\"><svg aria-hidden=\"true\" class=\"svg-inline--fa fa-clone absolute left-1/2 top-1/2 h-[1em] -translate-x-1/2 -translate-y-1/2 align-[-0.125em]\" data-icon=\"clone\" data-prefix=\"far\" focusable=\"false\" role=\"img\" viewbox=\"0 0 512 512\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M64 464H288c8.8 0 16-7.2 16-16V384h48v64c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V224c0-35.3 28.7-64 64-64h64v48H64c-8.8 0-16 7.2-16 16V448c0 8.8 7.2 16 16 16zM224 304H448c8.8 0 16-7.2 16-16V64c0-8.8-7.2-16-16-16H224c-8.8 0-16 7.2-16 16V288c0 8.8 7.2 16 16 16zm-64-16V64c0-35.3 28.7-64 64-64H448c35.3 0 64 28.7 64 64V288c0 35.3-28.7 64-64 64H224c-35.3 0-64-28.7-64-64z\" fill=\"currentColor\"></path></svg></div></div></div></div></div></div></div></div>\n<hr/>\n<h2 class=\"group/heading relative\" id=\"database\" level=\"2\"><a aria-hidden=\"true\" class=\"!text-sd-muted-foreground absolute right-full top-1/2 -translate-y-1/2 cursor-pointer pr-0.5 text-xs opacity-0 group-hover/heading:opacity-100\" href=\"#database\" tabindex=\"-1\"><div class=\"relative text-[12px] leading-[normal] p-[1px] before:block before:h-3 before:w-3\"><svg aria-hidden=\"true\" class=\"svg-inline--fa fa-link absolute left-1/2 top-1/2 h-[1em] -translate-x-1/2 -translate-y-1/2 align-[-0.125em]\" data-icon=\"link\" data-prefix=\"fas\" focusable=\"false\" role=\"img\" spacing=\"square\" viewbox=\"0 0 640 512\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z\" fill=\"currentColor\"></path></svg></div></a>Database</h2>\n<h3 class=\"group/heading relative\" id=\"approach-1-join\" level=\"3\"><a aria-hidden=\"true\" class=\"!text-sd-muted-foreground absolute right-full top-1/2 -translate-y-1/2 cursor-pointer pr-0.5 text-xs opacity-0 group-hover/heading:opacity-100\" href=\"#approach-1-join\" tabindex=\"-1\"><div class=\"relative text-[12px] leading-[normal] p-[1px] before:block before:h-3 before:w-3\"><svg aria-hidden=\"true\" class=\"svg-inline--fa fa-link absolute left-1/2 top-1/2 h-[1em] -translate-x-1/2 -translate-y-1/2 align-[-0.125em]\" data-icon=\"link\" data-prefix=\"fas\" focusable=\"false\" role=\"img\" spacing=\"square\" viewbox=\"0 0 640 512\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z\" fill=\"currentColor\"></path></svg></div></a>Approach 1: Join</h3>\n<h4 id=\"intuition-3\">Intuition</h4>\n<p>The idea here is to bring all the related information together first, and then decide what we need.</p>\n<p>By joining the <code>Trips</code> table with the <code>Users </code>table twice (once for clients and once for drivers), we combine all the data we might need into one unified table. After this \"assembly\", we filter out the data that doesn't meet our criteria (e.g., banned users or dates outside our range).</p>\n<p>This method is very direct: get everything together, then sift through to keep what's relevant.</p>\n<h4 id=\"algorithm-3\">Algorithm</h4>\n<ol>\n<li data-length=\"1\">\n<p><strong>Table Selection</strong>:</p>\n<ul>\n<li>Begin with the <code>Trips</code> table.</li>\n</ul>\n</li>\n<li data-length=\"1\">\n<p><strong>Joins</strong>:</p>\n<ul>\n<li>Perform a <code>LEFT JOIN</code> with the <code>Users</code> table (aliased as <code>Clients</code>). Join on the condition that <code>Trips.client_id</code> matches <code>Clients.users_id</code>. This combines each trip with information about its client.</li>\n<li>Perform another <code>LEFT JOIN</code> with the <code>Users</code> table (aliased as <code>Drivers</code>). Join on the condition that <code>Trips.driver_id</code> matches <code>Drivers.users_id</code>. This combines each trip with information about its driver.</li>\n</ul>\n</li>\n<li data-length=\"1\">\n<p><strong>Filter Data</strong>:</p>\n<ul>\n<li><code>WHERE</code> clause:\n<ul>\n<li>Exclude trips where the client (<code>Clients.banned</code>) is banned (<code>='No'</code>).</li>\n<li>Exclude trips where the driver (<code>Drivers.banned</code>) is banned (<code>='No'</code>).</li>\n<li>Only consider trips requested between October 1, 2013, and October 3, 2013 (<code>request_at BETWEEN '2013-10-01' AND '2013-10-03'</code>).</li>\n</ul>\n</li>\n</ul>\n</li>\n<li data-length=\"1\">\n<p><strong>Column Selection</strong>:</p>\n<ul>\n<li>Select the date the trip was requested (<code>request_at</code>) and alias it as <code>Day</code>.</li>\n<li>Calculate the cancellation rate:\n<ul>\n<li>The numerator is the sum of trips that are not completed (<code>SUM(status != 'completed')</code>). This counts trips with a status other than 'completed' as 1, and those with 'completed' status as 0.</li>\n<li>The denominator is the total count of trips (<code>COUNT(*)</code>).</li>\n<li>Divide the numerator by the denominator and round to two decimal places using <code>ROUND()</code>. Alias this calculated value as <code>'Cancellation Rate'</code>.</li>\n</ul>\n</li>\n</ul>\n</li>\n<li data-length=\"1\">\n<p><strong>Grouping</strong>:</p>\n<ul>\n<li><code>GROUP BY Day</code>: This groups the result set by the date of the trip request, meaning the cancellation rate will be calculated for each day separately.</li>\n</ul>\n</li>\n<li data-length=\"1\">\n<p><strong>Final Result</strong>:</p>\n<ul>\n<li>For each day between October 1, 2013, and October 3, 2013, where there are trips with non-banned clients and drivers, you will get:\n<ul>\n<li>The day.</li>\n<li>The cancellation rate for that day, rounded to two decimal places.</li>\n</ul>\n</li>\n</ul>\n</li>\n</ol>\n<h4 id=\"implementation-3\">Implementation</h4>\n<p>Based on the understanding above, the solution can be implemented as:</p>\n<div class=\"font-menlo mb-6 rounded-lg px-3 py-2.5 text-sm bg-fill-3 dark:bg-dark-fill-3\"><div class=\"group relative\" translate=\"no\"><pre style=\"color: black; font-size: 13px; text-shadow: none; font-family: Menlo, Monaco, Consolas; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 4; hyphens: none; padding: 0px; margin: 0px; overflow: auto; background: transparent; overflow-wrap: normal;\"><code class=\"language-sql\" style=\"white-space: pre; text-shadow: none;\"><span><span class=\"token\" style=\"color: rgb(0, 119, 170);\">SELECT</span><span> \n</span></span><span><span>  request_at </span><span class=\"token\" style=\"color: rgb(0, 119, 170);\">AS</span><span> </span><span class=\"token\" style=\"color: rgb(0, 119, 170);\">Day</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">,</span><span> \n</span></span><span><span>  </span><span class=\"token\" style=\"color: rgb(221, 74, 104);\">ROUND</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">(</span><span>\n</span></span><span><span>    </span><span class=\"token\" style=\"color: rgb(221, 74, 104);\">SUM</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">(</span><span class=\"token\" style=\"color: rgb(0, 119, 170);\">status</span><span> </span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">!=</span><span> </span><span class=\"token\" style=\"color: rgb(102, 153, 0);\">'completed'</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">)</span><span> </span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">/</span><span> </span><span class=\"token\" style=\"color: rgb(221, 74, 104);\">COUNT</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">(</span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">*</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">)</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">,</span><span> \n</span></span><span><span>    </span><span class=\"token\" style=\"color: rgb(153, 0, 85);\">2</span><span>\n</span></span><span><span>  </span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">)</span><span> </span><span class=\"token\" style=\"color: rgb(0, 119, 170);\">AS</span><span> </span><span class=\"token\" style=\"color: rgb(102, 153, 0);\">'Cancellation Rate'</span><span> \n</span></span><span><span></span><span class=\"token\" style=\"color: rgb(0, 119, 170);\">FROM</span><span> \n</span></span><span>  Trips \n</span><span><span>  </span><span class=\"token\" style=\"color: rgb(0, 119, 170);\">LEFT</span><span> </span><span class=\"token\" style=\"color: rgb(0, 119, 170);\">JOIN</span><span> Users </span><span class=\"token\" style=\"color: rgb(0, 119, 170);\">AS</span><span> Clients </span><span class=\"token\" style=\"color: rgb(0, 119, 170);\">ON</span><span> Trips</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">.</span><span>client_id </span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">=</span><span> Clients</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">.</span><span>users_id \n</span></span><span><span>  </span><span class=\"token\" style=\"color: rgb(0, 119, 170);\">LEFT</span><span> </span><span class=\"token\" style=\"color: rgb(0, 119, 170);\">JOIN</span><span> Users </span><span class=\"token\" style=\"color: rgb(0, 119, 170);\">AS</span><span> Drivers </span><span class=\"token\" style=\"color: rgb(0, 119, 170);\">ON</span><span> Trips</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">.</span><span>driver_id </span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">=</span><span> Drivers</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">.</span><span>users_id \n</span></span><span><span></span><span class=\"token\" style=\"color: rgb(0, 119, 170);\">WHERE</span><span> \n</span></span><span><span>  Clients</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">.</span><span>banned </span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">=</span><span> </span><span class=\"token\" style=\"color: rgb(102, 153, 0);\">'No'</span><span> \n</span></span><span><span>  </span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">AND</span><span> Drivers</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">.</span><span>banned </span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">=</span><span> </span><span class=\"token\" style=\"color: rgb(102, 153, 0);\">'No'</span><span> \n</span></span><span><span>  </span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">AND</span><span> request_at </span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">BETWEEN</span><span> </span><span class=\"token\" style=\"color: rgb(102, 153, 0);\">'2013-10-01'</span><span> \n</span></span><span><span>  </span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">AND</span><span> </span><span class=\"token\" style=\"color: rgb(102, 153, 0);\">'2013-10-03'</span><span> \n</span></span><span><span></span><span class=\"token\" style=\"color: rgb(0, 119, 170);\">GROUP</span><span> </span><span class=\"token\" style=\"color: rgb(0, 119, 170);\">BY</span><span> \n</span></span><span><span>  </span><span class=\"token\" style=\"color: rgb(0, 119, 170);\">Day</span><span>\n</span></span><span></span></code></pre><div class=\"absolute -right-1.5 -top-0.5 flex gap-2\"><div class=\"z-base-1 hidden rounded border group-hover:block border-border-quaternary dark:border-border-quaternary bg-layer-02 dark:bg-layer-02\"><div class=\"relative cursor-pointer flex h-[22px] w-[22px] items-center justify-center bg-layer-02 dark:bg-layer-02 hover:bg-fill-tertiary dark:hover:bg-fill-tertiary rounded-[4px]\" data-state=\"closed\"><div><div data-state=\"closed\"><div class=\"relative text-[12px] leading-[normal] p-[1px] before:block before:h-3 before:w-3 h-3.5 w-3.5 text-text-primary dark:text-text-primary\"><svg aria-hidden=\"true\" class=\"svg-inline--fa fa-clone absolute left-1/2 top-1/2 h-[1em] -translate-x-1/2 -translate-y-1/2 align-[-0.125em]\" data-icon=\"clone\" data-prefix=\"far\" focusable=\"false\" role=\"img\" viewbox=\"0 0 512 512\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M64 464H288c8.8 0 16-7.2 16-16V384h48v64c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V224c0-35.3 28.7-64 64-64h64v48H64c-8.8 0-16 7.2-16 16V448c0 8.8 7.2 16 16 16zM224 304H448c8.8 0 16-7.2 16-16V64c0-8.8-7.2-16-16-16H224c-8.8 0-16 7.2-16 16V288c0 8.8 7.2 16 16 16zm-64-16V64c0-35.3 28.7-64 64-64H448c35.3 0 64 28.7 64 64V288c0 35.3-28.7 64-64 64H224c-35.3 0-64-28.7-64-64z\" fill=\"currentColor\"></path></svg></div></div></div></div></div></div></div></div>\n<h3 class=\"group/heading relative\" id=\"approach-2-using-subqueries\" level=\"3\"><a aria-hidden=\"true\" class=\"!text-sd-muted-foreground absolute right-full top-1/2 -translate-y-1/2 cursor-pointer pr-0.5 text-xs opacity-0 group-hover/heading:opacity-100\" href=\"#approach-2-using-subqueries\" tabindex=\"-1\"><div class=\"relative text-[12px] leading-[normal] p-[1px] before:block before:h-3 before:w-3\"><svg aria-hidden=\"true\" class=\"svg-inline--fa fa-link absolute left-1/2 top-1/2 h-[1em] -translate-x-1/2 -translate-y-1/2 align-[-0.125em]\" data-icon=\"link\" data-prefix=\"fas\" focusable=\"false\" role=\"img\" spacing=\"square\" viewbox=\"0 0 640 512\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z\" fill=\"currentColor\"></path></svg></div></a>Approach 2: Using Subqueries</h3>\n<h4 id=\"intuition-4\">Intuition</h4>\n<p>The idea here is to first identify the data we don't want, and then exclude them from the following calculation.</p>\n<p>Instead of gathering everything and then filtering, this approach starts by explicitly listing what to exclude. The subqueries identify banned users. The main query then fetches trips, ensuring that any trips involving these banned users are avoided.</p>\n<h4 id=\"algorithm-4\">Algorithm</h4>\n<ol>\n<li data-length=\"1\">\n<p><strong>Initial Data Retrieval</strong></p>\n<ul>\n<li>From the table named <code>Trips</code>, retrieve rows (or records).</li>\n</ul>\n</li>\n<li data-length=\"1\">\n<p><strong>Filter by Date</strong></p>\n<ul>\n<li>Only consider rows where the <code>request_at</code> date is between the inclusive range from '2013-10-01' to '2013-10-03'.</li>\n</ul>\n</li>\n<li data-length=\"1\">\n<p><strong>Remove Banned Drivers</strong></p>\n<ul>\n<li>From the table named <code>Users</code>, retrieve all <code>users_id</code> values where <code>banned</code> is set to 'Yes'. These represent banned users.</li>\n<li>From the <code>Trips</code> table, exclude all rows where the <code>driver_id</code> is among the list of banned users from the previous step.</li>\n</ul>\n</li>\n<li data-length=\"1\">\n<p><strong>Remove Banned Clients</strong></p>\n<ul>\n<li>Similarly, from the <code>Trips</code> table, exclude all rows where the <code>client_id</code> is among the list of banned users.</li>\n</ul>\n</li>\n<li data-length=\"1\">\n<p><strong>Grouping</strong></p>\n<ul>\n<li>Group the filtered rows from the <code>Trips</code> table by the <code>request_at</code> date. For simplicity, we're renaming <code>request_at</code> to <code>Day</code>.</li>\n</ul>\n</li>\n<li data-length=\"1\">\n<p><strong>Calculate Cancellation Rate for Each Group</strong></p>\n<ul>\n<li>For each group (or for each unique date):\n<ul>\n<li>Calculate the sum of statuses that are not 'completed'. This is done by evaluating the condition <code>(status != 'completed')</code>, which will return <code>1</code> if the status is not 'completed' and <code>0</code> otherwise. Summing this up will give the total number of non-completed statuses.</li>\n<li>Calculate the total count of <code>status</code> for that group.</li>\n<li>Divide the sum of non-completed statuses by the total count of statuses.</li>\n<li>Round the resulting value to 2 decimal places.</li>\n<li>The final result represents the \"Cancellation Rate\" for that date.</li>\n</ul>\n</li>\n</ul>\n</li>\n<li data-length=\"1\">\n<p><strong>Output</strong></p>\n<ul>\n<li>For each date in the range, return:\n<ul>\n<li>The date (<code>Day</code>).</li>\n<li>The corresponding cancellation rate (<code>Cancellation Rate</code>).</li>\n</ul>\n</li>\n</ul>\n</li>\n</ol>\n<h4 id=\"implementation-4\">Implementation</h4>\n<p>Based on the understanding above, the solution can be implemented as:</p>\n<div class=\"font-menlo mb-6 rounded-lg px-3 py-2.5 text-sm bg-fill-3 dark:bg-dark-fill-3\"><div class=\"group relative\" translate=\"no\"><pre style=\"color: black; font-size: 13px; text-shadow: none; font-family: Menlo, Monaco, Consolas; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 4; hyphens: none; padding: 0px; margin: 0px; overflow: auto; background: transparent; overflow-wrap: normal;\"><code class=\"language-sql\" style=\"white-space: pre; text-shadow: none;\"><span><span class=\"token\" style=\"color: rgb(0, 119, 170);\">SELECT</span><span> \n</span></span><span><span>  request_at </span><span class=\"token\" style=\"color: rgb(0, 119, 170);\">AS</span><span> </span><span class=\"token\" style=\"color: rgb(0, 119, 170);\">Day</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">,</span><span> \n</span></span><span><span>  </span><span class=\"token\" style=\"color: rgb(221, 74, 104);\">ROUND</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">(</span><span>\n</span></span><span><span>    </span><span class=\"token\" style=\"color: rgb(221, 74, 104);\">SUM</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">(</span><span class=\"token\" style=\"color: rgb(0, 119, 170);\">status</span><span> </span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">!=</span><span> </span><span class=\"token\" style=\"color: rgb(102, 153, 0);\">'completed'</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">)</span><span> </span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">/</span><span> </span><span class=\"token\" style=\"color: rgb(221, 74, 104);\">COUNT</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">(</span><span class=\"token\" style=\"color: rgb(0, 119, 170);\">status</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">)</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">,</span><span> \n</span></span><span><span>    </span><span class=\"token\" style=\"color: rgb(153, 0, 85);\">2</span><span>\n</span></span><span><span>  </span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">)</span><span> </span><span class=\"token\" style=\"color: rgb(0, 119, 170);\">AS</span><span> </span><span class=\"token\" style=\"color: rgb(102, 153, 0);\">'Cancellation Rate'</span><span> \n</span></span><span><span></span><span class=\"token\" style=\"color: rgb(0, 119, 170);\">FROM</span><span> \n</span></span><span>  Trips \n</span><span><span></span><span class=\"token\" style=\"color: rgb(0, 119, 170);\">WHERE</span><span> \n</span></span><span><span>  request_at </span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">BETWEEN</span><span> </span><span class=\"token\" style=\"color: rgb(102, 153, 0);\">'2013-10-01'</span><span> \n</span></span><span><span>  </span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">AND</span><span> </span><span class=\"token\" style=\"color: rgb(102, 153, 0);\">'2013-10-03'</span><span> \n</span></span><span><span>  </span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">AND</span><span> driver_id </span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">NOT</span><span> </span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">IN</span><span> </span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">(</span><span>\n</span></span><span><span>    </span><span class=\"token\" style=\"color: rgb(0, 119, 170);\">SELECT</span><span> \n</span></span><span>      users_id \n</span><span><span>    </span><span class=\"token\" style=\"color: rgb(0, 119, 170);\">FROM</span><span> \n</span></span><span>      Users \n</span><span><span>    </span><span class=\"token\" style=\"color: rgb(0, 119, 170);\">WHERE</span><span> \n</span></span><span><span>      banned </span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">=</span><span> </span><span class=\"token\" style=\"color: rgb(102, 153, 0);\">'Yes'</span><span>\n</span></span><span><span>  </span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">)</span><span> \n</span></span><span><span>  </span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">AND</span><span> client_id </span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">NOT</span><span> </span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">IN</span><span> </span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">(</span><span>\n</span></span><span><span>    </span><span class=\"token\" style=\"color: rgb(0, 119, 170);\">SELECT</span><span> \n</span></span><span>      users_id \n</span><span><span>    </span><span class=\"token\" style=\"color: rgb(0, 119, 170);\">FROM</span><span> \n</span></span><span>      Users \n</span><span><span>    </span><span class=\"token\" style=\"color: rgb(0, 119, 170);\">WHERE</span><span> \n</span></span><span><span>      banned </span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">=</span><span> </span><span class=\"token\" style=\"color: rgb(102, 153, 0);\">'Yes'</span><span>\n</span></span><span><span>  </span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">)</span><span> \n</span></span><span><span></span><span class=\"token\" style=\"color: rgb(0, 119, 170);\">GROUP</span><span> </span><span class=\"token\" style=\"color: rgb(0, 119, 170);\">BY</span><span> \n</span></span><span><span>  </span><span class=\"token\" style=\"color: rgb(0, 119, 170);\">Day</span><span>\n</span></span><span></span></code></pre><div class=\"absolute -right-1.5 -top-0.5 flex gap-2\"><div class=\"z-base-1 hidden rounded border group-hover:block border-border-quaternary dark:border-border-quaternary bg-layer-02 dark:bg-layer-02\"><div class=\"relative cursor-pointer flex h-[22px] w-[22px] items-center justify-center bg-layer-02 dark:bg-layer-02 hover:bg-fill-tertiary dark:hover:bg-fill-tertiary rounded-[4px]\" data-state=\"closed\"><div><div data-state=\"closed\"><div class=\"relative text-[12px] leading-[normal] p-[1px] before:block before:h-3 before:w-3 h-3.5 w-3.5 text-text-primary dark:text-text-primary\"><svg aria-hidden=\"true\" class=\"svg-inline--fa fa-clone absolute left-1/2 top-1/2 h-[1em] -translate-x-1/2 -translate-y-1/2 align-[-0.125em]\" data-icon=\"clone\" data-prefix=\"far\" focusable=\"false\" role=\"img\" viewbox=\"0 0 512 512\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M64 464H288c8.8 0 16-7.2 16-16V384h48v64c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V224c0-35.3 28.7-64 64-64h64v48H64c-8.8 0-16 7.2-16 16V448c0 8.8 7.2 16 16 16zM224 304H448c8.8 0 16-7.2 16-16V64c0-8.8-7.2-16-16-16H224c-8.8 0-16 7.2-16 16V288c0 8.8 7.2 16 16 16zm-64-16V64c0-35.3 28.7-64 64-64H448c35.3 0 64 28.7 64 64V288c0 35.3-28.7 64-64 64H224c-35.3 0-64-28.7-64-64z\" fill=\"currentColor\"></path></svg></div></div></div></div></div></div></div></div>\n<h3 class=\"group/heading relative\" id=\"approach-3-using-common-table-expression-cte\" level=\"3\"><a aria-hidden=\"true\" class=\"!text-sd-muted-foreground absolute right-full top-1/2 -translate-y-1/2 cursor-pointer pr-0.5 text-xs opacity-0 group-hover/heading:opacity-100\" href=\"#approach-3-using-common-table-expression-cte\" tabindex=\"-1\"><div class=\"relative text-[12px] leading-[normal] p-[1px] before:block before:h-3 before:w-3\"><svg aria-hidden=\"true\" class=\"svg-inline--fa fa-link absolute left-1/2 top-1/2 h-[1em] -translate-x-1/2 -translate-y-1/2 align-[-0.125em]\" data-icon=\"link\" data-prefix=\"fas\" focusable=\"false\" role=\"img\" spacing=\"square\" viewbox=\"0 0 640 512\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z\" fill=\"currentColor\"></path></svg></div></a>Approach 3: Using Common Table Expression (CTE)</h3>\n<h4 id=\"intuition-5\">Intuition</h4>\n<p>The idea here is to prepare a clean workspace with only what we need, and then work on it.</p>\n<p>The CTE serves as this \"workspace\" or intermediary step. It pre-processes the data, filters out banned users, and selects only the desired date range. Once this clean, streamlined dataset (CTE) is ready, the main query can quickly compute the cancellation rate without distractions.</p>\n<h4 id=\"algorithm-5\">Algorithm</h4>\n<ol>\n<li data-length=\"1\">\n<p><strong>Initialize CTE (Common Table Expression) <code>TripStatus</code></strong>:</p>\n<ul>\n<li>A CTE is like a temporary result set that you can reference within a <code>SELECT</code>, <code>INSERT</code>, <code>UPDATE</code>, or <code>DELETE</code> statement.</li>\n</ul>\n</li>\n<li data-length=\"1\">\n<p><strong>From the <code>Trips</code> table</strong>:</p>\n<ul>\n<li>Select the <code>Request_at</code> column and rename it to <code>Day</code>.</li>\n<li>Evaluate if the trip status is not 'completed'. If true, it will return 1 (true), otherwise 0 (false). This is represented by the column <code>cancelled</code>.</li>\n</ul>\n</li>\n<li data-length=\"1\">\n<p><strong>Join the <code>Trips</code> table with <code>Users</code> table for Clients</strong>:</p>\n<ul>\n<li>The join condition is where <code>Client_Id</code> from the <code>Trips</code> table matches <code>Users_Id</code> from the <code>Users</code> table.</li>\n<li>Furthermore, only consider those rows where the client is not banned. This means that the <code>Banned</code> column for the client should be 'No'.</li>\n</ul>\n</li>\n<li data-length=\"1\">\n<p><strong>Join the result with <code>Users</code> table again but now for Drivers</strong>:</p>\n<ul>\n<li>Similarly, the join condition is where <code>Driver_Id</code> from the <code>Trips</code> table matches <code>Users_Id</code> from the <code>Users</code> table.</li>\n<li>Again, only consider those rows where the driver is not banned. This implies that the <code>Banned</code> column for the driver should be 'No'.</li>\n</ul>\n</li>\n<li data-length=\"1\">\n<p><strong>Filter the data</strong>:</p>\n<ul>\n<li>Only consider those trips which have the <code>Request_at</code> value between '2013-10-01' and '2013-10-03'.</li>\n</ul>\n</li>\n<li data-length=\"1\">\n<p><strong>Now, for the main query, using the CTE <code>TripStatus</code></strong>:</p>\n<ul>\n<li>Group the data by <code>Day</code>.</li>\n</ul>\n</li>\n<li data-length=\"1\">\n<p><strong>Calculate the Cancellation Rate for each day</strong>:</p>\n<ul>\n<li>For each day, sum the <code>cancelled</code> column. This will give the total number of cancelled trips for that day because a cancelled trip is represented by 1.</li>\n<li>For each day, count the <code>cancelled</code> column. This will give the total number of trips for that day, regardless of their status.</li>\n<li>Divide the sum by the count to get the cancellation rate for each day.</li>\n<li>Round this rate to 2 decimal places.</li>\n</ul>\n</li>\n<li data-length=\"1\">\n<p><strong>Final output</strong>:</p>\n<ul>\n<li>Return the <code>Day</code> and the calculated 'Cancellation Rate' for each day.</li>\n</ul>\n</li>\n</ol>\n<h4 id=\"implementation-5\">Implementation</h4>\n<p>Based on the understanding above, the solution can be implemented as:</p>\n<div class=\"font-menlo mb-6 rounded-lg px-3 py-2.5 text-sm bg-fill-3 dark:bg-dark-fill-3\"><div class=\"group relative\" translate=\"no\"><pre style=\"color: black; font-size: 13px; text-shadow: none; font-family: Menlo, Monaco, Consolas; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 4; hyphens: none; padding: 0px; margin: 0px; overflow: auto; background: transparent; overflow-wrap: normal;\"><code class=\"language-sql\" style=\"white-space: pre; text-shadow: none;\"><span><span class=\"token\" style=\"color: rgb(0, 119, 170);\">WITH</span><span> TripStatus </span><span class=\"token\" style=\"color: rgb(0, 119, 170);\">AS</span><span> </span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">(</span><span>\n</span></span><span><span>  </span><span class=\"token\" style=\"color: rgb(0, 119, 170);\">SELECT</span><span> \n</span></span><span><span>    Request_at </span><span class=\"token\" style=\"color: rgb(0, 119, 170);\">AS</span><span> </span><span class=\"token\" style=\"color: rgb(0, 119, 170);\">Day</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">,</span><span> \n</span></span><span><span>    T</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">.</span><span class=\"token\" style=\"color: rgb(0, 119, 170);\">status</span><span> </span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">!=</span><span> </span><span class=\"token\" style=\"color: rgb(102, 153, 0);\">'completed'</span><span> </span><span class=\"token\" style=\"color: rgb(0, 119, 170);\">AS</span><span> cancelled \n</span></span><span><span>  </span><span class=\"token\" style=\"color: rgb(0, 119, 170);\">FROM</span><span> \n</span></span><span>    Trips T \n</span><span><span>    </span><span class=\"token\" style=\"color: rgb(0, 119, 170);\">JOIN</span><span> Users C </span><span class=\"token\" style=\"color: rgb(0, 119, 170);\">ON</span><span> Client_Id </span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">=</span><span> C</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">.</span><span>Users_Id \n</span></span><span><span>    </span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">AND</span><span> C</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">.</span><span>Banned </span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">=</span><span> </span><span class=\"token\" style=\"color: rgb(102, 153, 0);\">'No'</span><span> \n</span></span><span><span>    </span><span class=\"token\" style=\"color: rgb(0, 119, 170);\">JOIN</span><span> Users D </span><span class=\"token\" style=\"color: rgb(0, 119, 170);\">ON</span><span> Driver_Id </span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">=</span><span> D</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">.</span><span>Users_Id \n</span></span><span><span>    </span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">AND</span><span> D</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">.</span><span>Banned </span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">=</span><span> </span><span class=\"token\" style=\"color: rgb(102, 153, 0);\">'No'</span><span> \n</span></span><span><span>  </span><span class=\"token\" style=\"color: rgb(0, 119, 170);\">WHERE</span><span> \n</span></span><span><span>    Request_at </span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">BETWEEN</span><span> </span><span class=\"token\" style=\"color: rgb(102, 153, 0);\">'2013-10-01'</span><span> \n</span></span><span><span>    </span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">AND</span><span> </span><span class=\"token\" style=\"color: rgb(102, 153, 0);\">'2013-10-03'</span><span>\n</span></span><span><span></span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">)</span><span> \n</span></span><span><span></span><span class=\"token\" style=\"color: rgb(0, 119, 170);\">SELECT</span><span> \n</span></span><span><span>  </span><span class=\"token\" style=\"color: rgb(0, 119, 170);\">Day</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">,</span><span> \n</span></span><span><span>  </span><span class=\"token\" style=\"color: rgb(221, 74, 104);\">ROUND</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">(</span><span>\n</span></span><span><span>    </span><span class=\"token\" style=\"color: rgb(221, 74, 104);\">SUM</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">(</span><span>cancelled</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">)</span><span> </span><span class=\"token\" style=\"color: rgb(154, 110, 58);\">/</span><span> </span><span class=\"token\" style=\"color: rgb(221, 74, 104);\">COUNT</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">(</span><span>cancelled</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">)</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">,</span><span> \n</span></span><span><span>    </span><span class=\"token\" style=\"color: rgb(153, 0, 85);\">2</span><span>\n</span></span><span><span>  </span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">)</span><span> </span><span class=\"token\" style=\"color: rgb(0, 119, 170);\">AS</span><span> </span><span class=\"token\" style=\"color: rgb(102, 153, 0);\">'Cancellation Rate'</span><span> \n</span></span><span><span></span><span class=\"token\" style=\"color: rgb(0, 119, 170);\">FROM</span><span> \n</span></span><span>  TripStatus \n</span><span><span></span><span class=\"token\" style=\"color: rgb(0, 119, 170);\">GROUP</span><span> </span><span class=\"token\" style=\"color: rgb(0, 119, 170);\">BY</span><span> \n</span></span><span><span>  </span><span class=\"token\" style=\"color: rgb(0, 119, 170);\">Day</span><span class=\"token\" style=\"color: rgb(153, 153, 153);\">;</span><span>\n</span></span><span></span></code></pre><div class=\"absolute -right-1.5 -top-0.5 flex gap-2\"><div class=\"z-base-1 hidden rounded border group-hover:block border-border-quaternary dark:border-border-quaternary bg-layer-02 dark:bg-layer-02\"><div class=\"relative cursor-pointer flex h-[22px] w-[22px] items-center justify-center bg-layer-02 dark:bg-layer-02 hover:bg-fill-tertiary dark:hover:bg-fill-tertiary rounded-[4px]\" data-state=\"closed\"><div><div data-state=\"closed\"><div class=\"relative text-[12px] leading-[normal] p-[1px] before:block before:h-3 before:w-3 h-3.5 w-3.5 text-text-primary dark:text-text-primary\"><svg aria-hidden=\"true\" class=\"svg-inline--fa fa-clone absolute left-1/2 top-1/2 h-[1em] -translate-x-1/2 -translate-y-1/2 align-[-0.125em]\" data-icon=\"clone\" data-prefix=\"far\" focusable=\"false\" role=\"img\" viewbox=\"0 0 512 512\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M64 464H288c8.8 0 16-7.2 16-16V384h48v64c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V224c0-35.3 28.7-64 64-64h64v48H64c-8.8 0-16 7.2-16 16V448c0 8.8 7.2 16 16 16zM224 304H448c8.8 0 16-7.2 16-16V64c0-8.8-7.2-16-16-16H224c-8.8 0-16 7.2-16 16V288c0 8.8 7.2 16 16 16zm-64-16V64c0-35.3 28.7-64 64-64H448c35.3 0 64 28.7 64 64V288c0 35.3-28.7 64-64 64H224c-35.3 0-64-28.7-64-64z\" fill=\"currentColor\"></path></svg></div></div></div></div></div></div></div></div></div><span style=\"font-size: 0px; line-height: 0;\"> </span></div>"}